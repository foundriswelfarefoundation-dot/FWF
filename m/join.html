<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <meta name="theme-color" content="#1e3a8a" />
  <title>Join FWF ‚Äî Membership</title>

  <link rel="manifest" href="../manifest.json">
  <link rel="icon" href="../assets/images/logo.png">
  <link href="../assets/css/mobile.css" rel="stylesheet">
  
  <style>
    .form-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 24px;
      position: relative;
    }
    
    .step {
      flex: 1;
      text-align: center;
      position: relative;
    }
    
    .step-number {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--border);
      color: var(--muted);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 8px;
      font-weight: bold;
      font-size: 14px;
    }
    
    .step.active .step-number {
      background: var(--brand1);
      color: white;
    }
    
    .step.completed .step-number {
      background: var(--accent);
      color: white;
    }
    
    .step-label {
      font-size: 12px;
      color: var(--muted);
    }
    
    .step.active .step-label {
      color: var(--brand1);
      font-weight: 600;
    }
    
    .form-section {
      display: none;
    }
    
    .form-section.active {
      display: block;
    }
    
    .file-upload {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .file-upload:hover {
      border-color: var(--brand1);
      background: var(--bg);
    }
    
    .file-upload input {
      display: none;
    }
    
    .preview-image {
      max-width: 100%;
      max-height: 200px;
      margin: 10px auto;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="index.html" class="brand">
        <img src="../assets/images/logo.png" alt="FWF" width="36" height="36">
        <span>FWF</span>
      </a>
      <button class="nav-toggle" id="navToggle">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <nav class="nav" id="mobileNav">
    <a href="index.html">Home</a>
    <a href="https://fwf-alpha.vercel.app/donation#donateModal" class="active">Join</a>
    <a href="https://fwf-alpha.vercel.app/donation#donateModal">Donate</a>
    <a href="projects.html">Projects</a>
    <a href="member-login.html">Login</a>
  </nav>

  <section style="padding: 20px 0;">
    <div class="container">
      <h1 class="text-center" style="margin-bottom: 8px;">üéØ Join FWF</h1>
      <p class="text-center" style="color: var(--muted); margin-bottom: 24px;">
        ‚Çπ200/month membership
      </p>

      <!-- Benefits Card -->
      <div class="card mb-3">
        <h3 style="margin-bottom: 12px;">‚ú® Membership Benefits</h3>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted);">
          <li>Free skill training programs</li>
          <li>Project assignments & earning</li>
          <li>One-on-one mentoring</li>
          <li>Job placement assistance</li>
        </ul>
      </div>

      <!-- Form Steps -->
      <div class="form-steps">
        <div class="step active" id="stepIndicator1">
          <div class="step-number">1</div>
          <div class="step-label">Personal</div>
        </div>
        <div class="step" id="stepIndicator2">
          <div class="step-number">2</div>
          <div class="step-label">Contact</div>
        </div>
        <div class="step" id="stepIndicator3">
          <div class="step-number">3</div>
          <div class="step-label">Payment</div>
        </div>
      </div>

      <!-- Form Card -->
      <div class="card">
        <div id="alertBox" class="alert hidden"></div>

        <form id="joinForm">
          <!-- Step 1: Personal Info -->
          <div class="form-section active" id="step1">
            <h3 class="mb-2">Personal Information</h3>
            
            <div class="form-group">
              <label>Full Name *</label>
              <input type="text" name="fullName" required placeholder="Enter your full name">
            </div>

            <div class="form-group">
              <label>Gender *</label>
              <select name="gender" required>
                <option value="">Select gender</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label>Date of Birth *</label>
              <input type="date" name="dob" required>
            </div>

            <div class="form-group">
              <label>Marital Status *</label>
              <select name="maritalStatus" required>
                <option value="">Select status</option>
                <option value="single">Single</option>
                <option value="married">Married</option>
                <option value="widowed">Widowed</option>
                <option value="divorced">Divorced</option>
              </select>
            </div>

            <button type="button" class="btn btn-primary btn-block" onclick="nextStep(2)">
              Next ‚Üí
            </button>
          </div>

          <!-- Step 2: Contact Info -->
          <div class="form-section" id="step2">
            <h3 class="mb-2">Contact Details</h3>
            
            <div class="form-group">
              <label>Mobile Number *</label>
              <input type="tel" name="mobile" required pattern="[0-9]{10}" placeholder="10-digit mobile">
            </div>

            <div class="form-group">
              <label>WhatsApp Number</label>
              <input type="tel" name="whatsapp" pattern="[0-9]{10}" placeholder="Optional">
            </div>

            <div class="form-group">
              <label>Email</label>
              <input type="email" name="email" placeholder="Optional">
            </div>

            <div class="form-group">
              <label>Address *</label>
              <textarea name="address" required rows="3" placeholder="Complete address"></textarea>
            </div>

            <div class="form-group">
              <label>City *</label>
              <input type="text" name="city" required placeholder="Your city">
            </div>

            <div class="form-group">
              <label>State *</label>
              <input type="text" name="state" required placeholder="Your state">
            </div>

            <div class="form-group">
              <label>PIN Code *</label>
              <input type="text" name="pincode" required pattern="[0-9]{6}" placeholder="6-digit PIN">
            </div>

            <div class="btn-group">
              <button type="button" class="btn btn-secondary" onclick="prevStep(1)">
                ‚Üê Back
              </button>
              <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                Next ‚Üí
              </button>
            </div>
          </div>

          <!-- Step 3: Payment -->
          <div class="form-section" id="step3">
            <h3 class="mb-2">Payment Details</h3>
            
            <div class="alert alert-info mb-2">
              <strong>‚Çπ200 Membership Fee</strong><br>
              Pay via UPI/Bank Transfer and upload screenshot
            </div>

            <div class="form-group">
              <label>Payment Method *</label>
              <select name="paymentMethod" required>
                <option value="">Select method</option>
                <option value="upi">UPI</option>
                <option value="bank">Bank Transfer</option>
                <option value="cash">Cash</option>
              </select>
            </div>

            <div class="form-group">
              <label>Transaction ID / Reference</label>
              <input type="text" name="transactionId" placeholder="Optional">
            </div>

            <div class="form-group">
              <label>Payment Screenshot *</label>
              <div class="file-upload" onclick="document.getElementById('paymentProof').click()">
                <input type="file" id="paymentProof" name="paymentProof" accept="image/*" required onchange="previewImage(this, 'paymentPreview')">
                <div id="paymentPreview">
                  <i class="fas fa-cloud-upload-alt" style="font-size: 40px; color: var(--brand1); margin-bottom: 8px;"></i>
                  <p><strong>Tap to upload payment proof</strong></p>
                  <p style="font-size: 12px; color: var(--muted);">JPG, PNG (Max 5MB)</p>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" name="agreeTerms" required style="width: auto;">
                <span style="font-size: 14px;">I agree to <a href="../terms.html" target="_blank">Terms & Conditions</a></span>
              </label>
            </div>

            <div class="btn-group">
              <button type="button" class="btn btn-secondary" onclick="prevStep(2)">
                ‚Üê Back
              </button>
              <button type="submit" class="btn btn-primary" id="submitBtn">
                Submit Application ‚Üí
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p><strong>FWF</strong> - Foundation for Women's Future</p>
      <p>&copy; 2025 FWF. All rights reserved.</p>
    </div>
  </footer>

  <script>
    let currentStep = 1;

    function nextStep(step) {
      // Validate current step
      const currentSection = document.getElementById(`step${currentStep}`);
      const inputs = currentSection.querySelectorAll('input[required], select[required], textarea[required]');
      
      let isValid = true;
      inputs.forEach(input => {
        if (!input.value) {
          isValid = false;
          input.style.borderColor = '#ef4444';
        } else {
          input.style.borderColor = '';
        }
      });

      if (!isValid) {
        showAlert('Please fill all required fields', 'error');
        return;
      }

      // Move to next step
      document.getElementById(`step${currentStep}`).classList.remove('active');
      document.getElementById(`stepIndicator${currentStep}`).classList.add('completed');
      
      currentStep = step;
      
      document.getElementById(`step${currentStep}`).classList.add('active');
      document.getElementById(`stepIndicator${currentStep}`).classList.add('active');
      
      window.scrollTo(0, 0);
    }

    function prevStep(step) {
      document.getElementById(`step${currentStep}`).classList.remove('active');
      document.getElementById(`stepIndicator${currentStep}`).classList.remove('active');
      
      currentStep = step;
      
      document.getElementById(`step${currentStep}`).classList.add('active');
      document.getElementById(`stepIndicator${currentStep -1}`).classList.remove('completed');
      
      window.scrollTo(0, 0);
    }

    function previewImage(input, previewId) {
      const preview = document.getElementById(previewId);
      const file = input.files[0];
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.innerHTML = `<img src="${e.target.result}" class="preview-image" alt="Preview">`;
        };
        reader.readAsDataURL(file);
      }
    }

    function showAlert(message, type = 'info') {
      const alertBox = document.getElementById('alertBox');
      alertBox.textContent = message;
      alertBox.className = `alert alert-${type}`;
      alertBox.classList.remove('hidden');
      setTimeout(() => alertBox.classList.add('hidden'), 5000);
    }

    // Form submission
    document.getElementById('joinForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      try {
        const formData = new FormData(this);
        
        const response = await fetch('/api/join', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.ok || response.ok) {
          showAlert('‚úÖ Application submitted successfully! Check your mobile for member ID.', 'success');
          setTimeout(() => window.location.href = 'member-login.html', 3000);
        } else {
          throw new Error(data.error || 'Submission failed');
        }
      } catch (error) {
        console.error('Error:', error);
        showAlert('‚ùå ' + error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application ‚Üí';
      }
    });

    // Mobile nav toggle
    document.getElementById('navToggle')?.addEventListener('click', () => {
      document.getElementById('mobileNav')?.classList.toggle('show');
    });

    // Prevent form resubmission on back button
    if (window.history.replaceState) {
      window.history.replaceState(null, null, window.location.href);
    }
  </script>

  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
</body>
</html>
