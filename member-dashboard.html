<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Member Dashboard ‚Äî FWF</title>
  <link rel="icon" type="image/png" href="assets/images/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
/* ==============================
   CSS VARIABLES ‚Äî TIME THEMES
   ============================== */
:root {
  /* Morning (5AM-12PM): Fresh blue/green */
  --bg-1:#e8f4fd; --bg-2:#dbeafe; --bg-3:#f0fdf4;
  --accent:#3b82f6; --accent2:#10b981; --accent-soft:rgba(59,130,246,.12);
  --sidebar-bg:linear-gradient(180deg,#1e3a5f 0%,#1e40af 100%);
  --sidebar-text:#e0edff;
  --card-bg:#ffffff; --card-border:#e2e8f0;
  --text-primary:#0f172a; --text-secondary:#475569; --text-muted:#94a3b8;
  --glass:rgba(255,255,255,.82);
  --point-glow:rgba(59,130,246,.25);
}
html[data-theme="afternoon"] {
  --bg-1:#fefce8; --bg-2:#fff7ed; --bg-3:#fef3c7;
  --accent:#f59e0b; --accent2:#ef4444; --accent-soft:rgba(245,158,11,.12);
  --sidebar-bg:linear-gradient(180deg,#78350f 0%,#b45309 100%);
  --sidebar-text:#fef3c7;
  --card-bg:#fffbeb; --card-border:#fde68a;
  --text-primary:#1c1917; --text-secondary:#57534e; --text-muted:#a8a29e;
  --glass:rgba(255,251,235,.85);
  --point-glow:rgba(245,158,11,.25);
}
html[data-theme="evening"] {
  --bg-1:#1e1b2e; --bg-2:#1a1625; --bg-3:#2d2640;
  --accent:#a78bfa; --accent2:#f472b6; --accent-soft:rgba(167,139,250,.15);
  --sidebar-bg:linear-gradient(180deg,#1a1625 0%,#2d2640 100%);
  --sidebar-text:#c4b5fd;
  --card-bg:#2d2640; --card-border:#3d3556;
  --text-primary:#f1f0f5; --text-secondary:#a09bb5; --text-muted:#6d6880;
  --glass:rgba(45,38,64,.85);
  --point-glow:rgba(167,139,250,.3);
}

/* ==============================
   RESET & BASE
   ============================== */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Plus Jakarta Sans',system-ui,sans-serif;
  background:linear-gradient(135deg,var(--bg-1),var(--bg-2),var(--bg-3));
  min-height:100vh;
  color:var(--text-primary);
  display:flex;
  transition:background .6s ease, color .4s ease;
}
a{color:inherit;text-decoration:none}

/* ==============================
   SIDEBAR
   ============================== */
.sidebar{
  position:fixed; left:0; top:0; bottom:0; width:260px; z-index:100;
  background:var(--sidebar-bg);
  display:flex; flex-direction:column;
  padding:24px 16px 16px;
  transition:transform .3s ease, background .6s ease;
}
.sidebar-brand{
  display:flex; align-items:center; gap:12px;
  padding:0 8px 24px; border-bottom:1px solid rgba(255,255,255,.12);
  margin-bottom:16px;
}
.sidebar-brand img{ width:42px; height:42px; border-radius:12px; }
.sidebar-brand span{
  font-size:20px; font-weight:900; color:#fff;
  letter-spacing:-.5px;
}
.sidebar-nav{ flex:1; display:flex; flex-direction:column; gap:4px; }
.nav-item{
  display:flex; align-items:center; gap:14px;
  padding:12px 16px; border-radius:12px;
  font-size:14px; font-weight:700;
  color:var(--sidebar-text); opacity:.7;
  cursor:pointer; transition:all .2s;
  border:none; background:none; width:100%; text-align:left;
  font-family:inherit;
}
.nav-item:hover{ opacity:1; background:rgba(255,255,255,.08); }
.nav-item.active{
  opacity:1; background:rgba(255,255,255,.15);
  box-shadow:inset 3px 0 0 var(--accent);
}
.nav-item i{ width:20px; text-align:center; font-size:16px; }
.nav-badge{
  margin-left:auto; background:var(--accent); color:#fff;
  padding:2px 8px; border-radius:99px; font-size:11px; font-weight:800;
}
.sidebar-footer{
  border-top:1px solid rgba(255,255,255,.12);
  padding-top:14px; margin-top:auto;
}
.nav-item.logout-btn{ color:#f87171; opacity:.9; }
.nav-item.logout-btn:hover{ background:rgba(248,113,113,.12); }

/* ==============================
   MAIN CONTENT
   ============================== */
.main{
  flex:1; margin-left:260px;
  padding:24px 32px;
  min-height:100vh;
  transition:margin .3s ease;
}

/* ==============================
   MOBILE TOGGLE
   ============================== */
.mobile-toggle{
  display:none; position:fixed; top:16px; left:16px; z-index:200;
  width:44px; height:44px; border-radius:12px;
  background:var(--card-bg); border:1px solid var(--card-border);
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  font-size:18px; cursor:pointer; color:var(--text-primary);
  font-family:inherit;
}
.mobile-overlay{
  display:none; position:fixed; inset:0; z-index:90;
  background:rgba(0,0,0,.4); backdrop-filter:blur(4px);
}

/* ==============================
   TOP BAR
   ============================== */
.topbar{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:28px; flex-wrap:wrap; gap:16px;
}
.greeting h1{
  font-size:28px; font-weight:900; letter-spacing:-.5px;
  color:var(--text-primary);
}
.greeting p{ color:var(--text-secondary); font-weight:600; margin-top:2px; }
.topbar-right{ display:flex; align-items:center; gap:12px; }
.member-badge{
  display:inline-flex; align-items:center; gap:8px;
  background:var(--accent-soft); color:var(--accent);
  padding:8px 16px; border-radius:99px;
  font-size:13px; font-weight:800;
}
.theme-indicator{
  width:36px; height:36px; border-radius:10px;
  background:var(--accent-soft); border:1px solid var(--card-border);
  display:grid; place-items:center; font-size:16px;
  cursor:default;
}

/* ==============================
   PAGE SECTIONS
   ============================== */
.page{ display:none; animation:fadeIn .35s ease; }
.page.active{ display:block; }
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* ==============================
   STAT CARDS GRID
   ============================== */
.stats-row{
  display:grid; grid-template-columns:repeat(4,1fr); gap:18px;
  margin-bottom:28px;
}
.stat-card{
  background:var(--card-bg); border:1px solid var(--card-border);
  border-radius:18px; padding:22px;
  box-shadow:0 4px 14px rgba(0,0,0,.04);
  transition:transform .2s, box-shadow .2s, background .4s;
  position:relative; overflow:hidden;
}
.stat-card:hover{ transform:translateY(-3px); box-shadow:0 8px 24px rgba(0,0,0,.08); }
.stat-card .stat-icon{
  width:44px; height:44px; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  font-size:20px; margin-bottom:14px;
}
.stat-card .stat-label{
  font-size:12px; font-weight:700; color:var(--text-muted);
  text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px;
}
.stat-card .stat-value{
  font-size:28px; font-weight:900; color:var(--text-primary);
  letter-spacing:-.5px;
}
.stat-card .stat-sub{ font-size:12px; color:var(--text-secondary); margin-top:4px; font-weight:600; }
.icon-points{ background:linear-gradient(135deg,#fbbf24,#f59e0b); color:#fff; }
.icon-donation{ background:linear-gradient(135deg,#10b981,#059669); color:#fff; }
.icon-referral{ background:linear-gradient(135deg,#3b82f6,#2563eb); color:#fff; }
.icon-quiz{ background:linear-gradient(135deg,#8b5cf6,#7c3aed); color:#fff; }
.icon-wallet{ background:linear-gradient(135deg,#f59e0b,#d97706); color:#fff; }
.icon-target{ background:linear-gradient(135deg,#10b981,#047857); color:#fff; }
.icon-applied{ background:linear-gradient(135deg,#3b82f6,#1d4ed8); color:#fff; }
.icon-cash{ background:linear-gradient(135deg,#ec4899,#be185d); color:#fff; }

/* ==============================
   CONTENT CARDS
   ============================== */
.content-card{
  background:var(--card-bg); border:1px solid var(--card-border);
  border-radius:18px; padding:24px;
  box-shadow:0 4px 14px rgba(0,0,0,.04);
  margin-bottom:20px;
  transition:background .4s, border-color .4s;
}
.content-card h3{
  font-size:18px; font-weight:800; margin-bottom:16px;
  display:flex; align-items:center; gap:10px;
  color:var(--text-primary);
}
.content-card h3 i{ color:var(--accent); }

/* ==============================
   GRID LAYOUTS
   ============================== */
.grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px; }

/* ==============================
   FORMS & INPUTS
   ============================== */
.form-group{ margin-bottom:16px; }
.form-group label{
  display:block; font-size:13px; font-weight:700;
  color:var(--text-secondary); margin-bottom:6px;
}
.form-input{
  width:100%; padding:12px 16px;
  border:2px solid var(--card-border); border-radius:12px;
  background:var(--card-bg); color:var(--text-primary);
  font:inherit; font-size:14px; font-weight:600;
  transition:border-color .2s, box-shadow .2s;
}
.form-input:focus{
  outline:none; border-color:var(--accent);
  box-shadow:0 0 0 4px var(--accent-soft);
}
.form-input::placeholder{ color:var(--text-muted); }
.form-row{ display:flex; gap:12px; flex-wrap:wrap; }
.form-row .form-group{ flex:1; min-width:200px; }

/* ==============================
   BUTTONS
   ============================== */
.btn{
  padding:12px 24px; border:none; border-radius:12px;
  font:inherit; font-size:14px; font-weight:800;
  cursor:pointer; display:inline-flex; align-items:center; gap:8px;
  transition:all .2s;
}
.btn-primary{
  background:var(--accent); color:#fff;
  box-shadow:0 4px 12px var(--point-glow);
}
.btn-primary:hover{ transform:translateY(-2px); box-shadow:0 8px 20px var(--point-glow); }
.btn-secondary{
  background:var(--accent-soft); color:var(--accent);
  border:1px solid var(--card-border);
}
.btn-secondary:hover{ background:var(--accent); color:#fff; }
.btn-sm{ padding:8px 16px; font-size:12px; }

/* ==============================
   TABLES
   ============================== */
.data-table{ width:100%; border-collapse:collapse; }
.data-table th{
  text-align:left; font-size:11px; font-weight:700;
  color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px;
  padding:10px 14px; border-bottom:2px solid var(--card-border);
}
.data-table td{
  padding:12px 14px; border-bottom:1px solid var(--card-border);
  font-size:13px; font-weight:600; color:var(--text-secondary);
}
.data-table tr:last-child td{ border-bottom:0; }
.data-table .badge{
  display:inline-flex; padding:3px 10px; border-radius:99px;
  font-size:11px; font-weight:800;
}
.badge-active{ background:#dcfce7; color:#166534; }
.badge-pending{ background:#fef3c7; color:#92400e; }
.badge-donation{ background:#d1fae5; color:#065f46; }
.badge-referral{ background:#dbeafe; color:#1e40af; }
.badge-quiz{ background:#ede9fe; color:#5b21b6; }

/* ==============================
   POINTS DISPLAY
   ============================== */
.points-hero{
  background:var(--sidebar-bg); border-radius:20px;
  padding:32px; color:#fff; position:relative; overflow:hidden;
  margin-bottom:20px;
}
.points-hero::before{
  content:""; position:absolute; right:-40px; top:-40px;
  width:200px; height:200px; border-radius:50%;
  background:rgba(255,255,255,.08);
}
.points-hero::after{
  content:""; position:absolute; right:40px; bottom:-60px;
  width:150px; height:150px; border-radius:50%;
  background:rgba(255,255,255,.05);
}
.points-hero .pts-label{ font-size:14px; font-weight:600; opacity:.8; margin-bottom:8px; }
.points-hero .pts-value{ font-size:52px; font-weight:900; letter-spacing:-2px; }
.points-hero .pts-sub{ font-size:14px; opacity:.7; margin-top:4px; font-weight:600; }
.pts-breakdown{
  display:flex; gap:24px; margin-top:20px; padding-top:20px;
  border-top:1px solid rgba(255,255,255,.15);
}
.pts-breakdown .pts-item span{ display:block; font-size:11px; opacity:.6; font-weight:600; }
.pts-breakdown .pts-item strong{ font-size:18px; font-weight:800; }

/* ==============================
   REFERRAL CARD
   ============================== */
.referral-box{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border-radius:16px; padding:24px; color:#fff;
  display:flex; align-items:center; gap:20px;
  margin-bottom:20px;
}
.referral-box .ref-code{
  background:rgba(255,255,255,.2); backdrop-filter:blur(8px);
  padding:10px 20px; border-radius:10px;
  font-size:18px; font-weight:900; letter-spacing:1px;
  font-family:monospace;
}
.referral-box .copy-btn{
  background:rgba(255,255,255,.25); border:none; color:#fff;
  padding:10px 16px; border-radius:10px; font-weight:800;
  cursor:pointer; font-size:13px; transition:.2s;
  font-family:inherit;
}
.referral-box .copy-btn:hover{ background:rgba(255,255,255,.4); }

/* ==============================
   PROFILE SECTION
   ============================== */
.profile-header{
  text-align:center; padding:32px 24px;
}
.profile-avatar{
  width:100px; height:100px; border-radius:50%;
  background:var(--sidebar-bg); color:#fff;
  display:flex; align-items:center; justify-content:center;
  font-size:36px; font-weight:900; margin:0 auto 16px;
  box-shadow:0 8px 24px var(--point-glow);
}
.profile-name{ font-size:24px; font-weight:900; }
.profile-id{ color:var(--text-muted); font-weight:700; margin-top:4px; }

/* ==============================
   STORE PLACEHOLDER
   ============================== */
.store-placeholder{
  text-align:center; padding:80px 24px;
  color:var(--text-muted);
}
.store-placeholder i{ font-size:64px; margin-bottom:16px; opacity:.3; }
.store-placeholder h3{ font-size:24px; margin-bottom:8px; color:var(--text-secondary); }

/* ==============================
   WELCOME MODAL
   ============================== */
.welcome-overlay{
  position:fixed; inset:0; z-index:999;
  background:rgba(15,23,42,.6); backdrop-filter:blur(8px);
  display:flex; align-items:center; justify-content:center;
  padding:20px; animation:fadeIn .4s;
}
.welcome-overlay.hidden{ display:none; }
.welcome-letter{
  background:#fff; border-radius:24px;
  max-width:600px; width:100%;
  padding:48px 40px; position:relative;
  box-shadow:0 30px 80px rgba(0,0,0,.25);
  animation:scaleIn .5s cubic-bezier(.34,1.56,.64,1);
  text-align:center;
}
@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.welcome-letter .wl-logo{ width:72px; margin-bottom:20px; }
.welcome-letter h2{
  font-size:28px; font-weight:900; margin-bottom:8px;
  background:linear-gradient(135deg,#22c55e,#3b82f6);
  -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
}
.welcome-letter .wl-name{ font-size:20px; font-weight:800; margin-bottom:16px; color:#1e293b; }
.welcome-letter .wl-body{
  font-size:15px; line-height:1.7; color:#475569; text-align:left;
  margin-bottom:24px; font-weight:500;
}
.welcome-letter .wl-id{
  display:inline-flex; align-items:center; gap:8px;
  background:linear-gradient(135deg,#667eea,#764ba2);
  color:#fff; padding:10px 24px; border-radius:99px;
  font-size:16px; font-weight:800; margin-bottom:24px;
}
.welcome-letter .wl-btn{
  background:linear-gradient(135deg,#22c55e,#3b82f6);
  color:#fff; border:none; padding:14px 36px;
  border-radius:14px; font-size:16px; font-weight:800;
  cursor:pointer; box-shadow:0 8px 24px rgba(34,197,94,.3);
  transition:.2s; font-family:inherit;
}
.welcome-letter .wl-btn:hover{ transform:translateY(-2px); box-shadow:0 12px 32px rgba(34,197,94,.4); }

/* ==============================
   EMPTY STATE
   ============================== */
.empty-row{
  text-align:center; padding:32px; color:var(--text-muted);
  font-weight:600; font-size:14px;
}

/* ==============================
   HOW POINTS CARDS
   ============================== */
.how-card{
  padding:20px; border-radius:14px; background:var(--accent-soft);
  transition:transform .2s;
}
.how-card:hover{ transform:translateY(-2px); }
.how-card .how-emoji{ font-size:32px; margin-bottom:10px; }
.how-card strong{ font-size:14px; display:block; margin-bottom:6px; color:var(--text-primary); }
.how-card span{ font-size:12px; color:var(--text-secondary); font-weight:500; line-height:1.5; }
.how-card .how-highlight{ font-weight:800; color:var(--accent); }

/* ==============================
   RESPONSIVE
   ============================== */
@media(max-width:1100px){
  .stats-row{ grid-template-columns:repeat(2,1fr); }
  .grid-3{ grid-template-columns:1fr 1fr; }
}
@media(max-width:900px){
  .sidebar{ transform:translateX(-100%); }
  .sidebar.open{ transform:translateX(0); }
  .main{ margin-left:0; padding:16px; padding-top:68px; }
  .mobile-toggle{ display:grid; place-items:center; }
  .mobile-overlay.show{ display:block; }
}
@media(max-width:640px){
  .stats-row{ grid-template-columns:1fr; }
  .grid-2,.grid-3{ grid-template-columns:1fr; }
  .pts-breakdown{ flex-direction:column; gap:12px; }
  .referral-box{ flex-direction:column; text-align:center; }
  .form-row{ flex-direction:column; }
  .form-row .form-group{ min-width:100%; }
  .topbar{ flex-direction:column; align-items:flex-start; }
  .greeting h1{ font-size:22px; }
  .welcome-letter{ padding:32px 24px; }
}
  </style>
</head>
<body>

<!-- Mobile toggle -->
<button class="mobile-toggle" id="mobileToggle"><i class="fa-solid fa-bars"></i></button>
<div class="mobile-overlay" id="mobileOverlay"></div>

<!-- ======== SIDEBAR ======== -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-brand">
    <img src="assets/images/logo.png" alt="FWF">
    <span>FWF</span>
  </div>
  <nav class="sidebar-nav">
    <button class="nav-item active" data-page="home">
      <i class="fa-solid fa-house"></i> Home
    </button>
    <button class="nav-item" data-page="projects">
      <i class="fa-solid fa-diagram-project"></i> Projects
    </button>
    <button class="nav-item" data-page="wallet">
      <i class="fa-solid fa-wallet"></i> Wallet & Points
    </button>
    <button class="nav-item" data-page="profile">
      <i class="fa-solid fa-user"></i> Profile
    </button>
    <button class="nav-item" data-page="store">
      <i class="fa-solid fa-store"></i> Store
      <span class="nav-badge">Soon</span>
    </button>
  </nav>
  <div class="sidebar-footer">
    <button class="nav-item logout-btn" id="logoutBtn">
      <i class="fa-solid fa-right-from-bracket"></i> Logout
    </button>
  </div>
</aside>

<!-- ======== MAIN ======== -->
<main class="main">
  <!-- TOP BAR -->
  <div class="topbar">
    <div class="greeting">
      <h1 id="greetingText">Welcome</h1>
      <p id="greetingSub">Here's your dashboard overview</p>
    </div>
    <div class="topbar-right">
      <span class="member-badge"><i class="fa-solid fa-id-card"></i> <span id="topMemberId">...</span></span>
      <div class="theme-indicator" id="themeIcon" title="Theme changes with time of day"></div>
    </div>
  </div>

  <!-- ===================== HOME PAGE ===================== -->
  <div class="page active" id="page-home">
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon icon-points"><i class="fa-solid fa-coins"></i></div>
        <div class="stat-label">Total Points</div>
        <div class="stat-value" id="homePoints">0</div>
        <div class="stat-sub">1 point = ‚Çπ10 value</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon icon-donation"><i class="fa-solid fa-hand-holding-heart"></i></div>
        <div class="stat-label">Donation Points</div>
        <div class="stat-value" id="homeDonPts">0</div>
        <div class="stat-sub">From donations collected</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon icon-referral"><i class="fa-solid fa-user-plus"></i></div>
        <div class="stat-label">Referral Points</div>
        <div class="stat-value" id="homeRefPts">0</div>
        <div class="stat-sub">From member referrals</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon icon-quiz"><i class="fa-solid fa-ticket"></i></div>
        <div class="stat-label">Quiz Points</div>
        <div class="stat-value" id="homeQuizPts">0</div>
        <div class="stat-sub">From ticket sales</div>
      </div>
    </div>

    <div class="grid-2">
      <div class="content-card">
        <h3><i class="fa-solid fa-bolt"></i> Quick Actions</h3>
        <div style="display:flex;flex-direction:column;gap:10px">
          <button class="btn btn-primary" onclick="switchPage('wallet')">
            <i class="fa-solid fa-plus-circle"></i> Record Donation
          </button>
          <button class="btn btn-secondary" onclick="switchPage('wallet')">
            <i class="fa-solid fa-ticket"></i> Sell Quiz Ticket
          </button>
          <button class="btn btn-secondary" onclick="copyReferralLink()">
            <i class="fa-solid fa-share-nodes"></i> Share Referral Link
          </button>
        </div>
      </div>
      <div class="content-card">
        <h3><i class="fa-solid fa-share-nodes"></i> Your Referral</h3>
        <div class="referral-box">
          <div>
            <div style="font-size:13px;opacity:.8;margin-bottom:6px;font-weight:600">Your referral code</div>
            <div class="ref-code" id="homeRefCode">---</div>
          </div>
          <button class="copy-btn" onclick="copyReferralLink()"><i class="fa-solid fa-copy"></i> Copy Link</button>
        </div>
        <div style="display:flex;gap:24px;margin-top:4px">
          <div><span style="font-size:12px;color:var(--text-muted);font-weight:600">Total Referrals</span><br><strong id="homeRefTotal" style="font-size:20px">0</strong></div>
          <div><span style="font-size:12px;color:var(--text-muted);font-weight:600">Active</span><br><strong id="homeRefActive" style="font-size:20px;color:var(--accent)">0</strong></div>
        </div>
      </div>
    </div>

    <div class="content-card" style="margin-top:20px">
      <h3><i class="fa-solid fa-clock-rotate-left"></i> Recent Points Activity</h3>
      <table class="data-table">
        <thead><tr><th>Type</th><th>Points</th><th>Description</th><th>Date</th></tr></thead>
        <tbody id="homeActivity">
          <tr><td colspan="4" class="empty-row">No activity yet. Start earning points!</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== PROJECTS PAGE ===================== -->
  <div class="page" id="page-projects">
    <div class="stats-row" style="grid-template-columns:repeat(3,1fr)">
      <div class="stat-card">
        <div class="stat-icon icon-wallet"><i class="fa-solid fa-indian-rupee-sign"></i></div>
        <div class="stat-label">Wallet Balance</div>
        <div class="stat-value">‚Çπ<span id="projWbal">0</span></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon icon-target"><i class="fa-solid fa-bullseye"></i></div>
        <div class="stat-label">Target 60%</div>
        <div class="stat-value">‚Çπ<span id="projTgt">0</span></div>
      </div>
      <div class="stat-card">
        <div class="stat-icon icon-applied"><i class="fa-solid fa-check-circle"></i></div>
        <div class="stat-label">Wallet Applied</div>
        <div class="stat-value">‚Çπ<span id="projApplied">0</span></div>
      </div>
    </div>

    <div class="content-card">
      <h3><i class="fa-solid fa-paper-plane"></i> Apply Wallet to Project</h3>
      <p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px;font-weight:500">
        Your wallet balance adjusts project funding targets. Use wallet funds to reduce your 60% target.
      </p>
      <div class="form-row">
        <div class="form-group" style="flex:2">
          <label>Amount (‚Çπ)</label>
          <input type="number" class="form-input" id="applyAmount" placeholder="Enter amount" min="1">
        </div>
        <div class="form-group" style="flex:1;display:flex;align-items:flex-end">
          <button class="btn btn-primary" id="applyWalletBtn" style="width:100%">
            <i class="fa-solid fa-check"></i> Apply
          </button>
        </div>
      </div>
    </div>

    <div class="content-card">
      <h3><i class="fa-solid fa-folder-open"></i> Browse Projects</h3>
      <p style="color:var(--text-secondary);font-size:14px;font-weight:500">
        <a href="/projects" style="color:var(--accent);font-weight:700"><i class="fa-solid fa-external-link"></i> View all available projects</a>
      </p>
    </div>
  </div>

  <!-- ===================== WALLET & POINTS PAGE ===================== -->
  <div class="page" id="page-wallet">
    <div class="points-hero">
      <div class="pts-label"><i class="fa-solid fa-coins"></i> Your Points Balance</div>
      <div class="pts-value" id="walletPtsBalance">0</div>
      <div class="pts-sub">1 point = ‚Çπ10 value (Total value: ‚Çπ<span id="walletPtsValue">0</span>)</div>
      <div class="pts-breakdown">
        <div class="pts-item">
          <span><i class="fa-solid fa-hand-holding-heart"></i> Donations</span>
          <strong id="walletDonPts">0</strong>
        </div>
        <div class="pts-item">
          <span><i class="fa-solid fa-user-plus"></i> Referrals</span>
          <strong id="walletRefPts">0</strong>
        </div>
        <div class="pts-item">
          <span><i class="fa-solid fa-ticket"></i> Quiz Tickets</span>
          <strong id="walletQuizPts">0</strong>
        </div>
      </div>
    </div>

    <div class="content-card">
      <h3><i class="fa-solid fa-info-circle"></i> How Points Work</h3>
      <div class="grid-3">
        <div class="how-card">
          <div class="how-emoji">üí∞</div>
          <strong>Donations (10%)</strong>
          <span>Collect ‚Çπ1000 donation ‚Üí ‚Çπ100 (10%) ‚Üí <span class="how-highlight">10 points</span></span>
        </div>
        <div class="how-card">
          <div class="how-emoji">üë•</div>
          <strong>Referrals (50%)</strong>
          <span>New member pays ‚Çπ500 ‚Üí ‚Çπ250 (50%) ‚Üí <span class="how-highlight">25 points</span></span>
        </div>
        <div class="how-card">
          <div class="how-emoji">üéüÔ∏è</div>
          <strong>Quiz Tickets (10%)</strong>
          <span>Sell ‚Çπ100 ticket ‚Üí ‚Çπ10 (10%) ‚Üí <span class="how-highlight">1 point</span></span>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <div class="content-card">
        <h3><i class="fa-solid fa-hand-holding-heart"></i> Record Donation</h3>
        <div class="form-group">
          <label>Donation Amount (‚Çπ)</label>
          <input type="number" class="form-input" id="donationAmt" placeholder="e.g. 1000" min="1">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Donor Name (optional)</label>
            <input type="text" class="form-input" id="donorName" placeholder="Donor's name">
          </div>
          <div class="form-group">
            <label>Donor Contact (optional)</label>
            <input type="text" class="form-input" id="donorContact" placeholder="Phone / Email">
          </div>
        </div>
        <button class="btn btn-primary" id="recordDonationBtn">
          <i class="fa-solid fa-plus"></i> Record & Earn Points
        </button>
      </div>

      <div class="content-card">
        <h3><i class="fa-solid fa-ticket"></i> Sell Quiz Ticket</h3>
        <p style="color:var(--text-secondary);font-size:13px;margin-bottom:14px;font-weight:500">
          Ticket price: ‚Çπ100 | You earn: 1 point per ticket
        </p>
        <div class="form-row">
          <div class="form-group">
            <label>Buyer Name</label>
            <input type="text" class="form-input" id="ticketBuyer" placeholder="Buyer's name">
          </div>
          <div class="form-group">
            <label>Buyer Contact</label>
            <input type="text" class="form-input" id="ticketContact" placeholder="Phone / Email">
          </div>
        </div>
        <button class="btn btn-primary" id="sellTicketBtn">
          <i class="fa-solid fa-ticket"></i> Sell Ticket & Earn Points
        </button>
      </div>
    </div>

    <div class="content-card">
      <h3><i class="fa-solid fa-list"></i> Points History</h3>
      <table class="data-table">
        <thead><tr><th>Type</th><th>Points</th><th>Description</th><th>Date</th></tr></thead>
        <tbody id="walletHistory">
          <tr><td colspan="4" class="empty-row">No transactions yet</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===================== PROFILE PAGE ===================== -->
  <div class="page" id="page-profile">
    <div class="content-card">
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">M</div>
        <div class="profile-name" id="profileName">Member</div>
        <div class="profile-id" id="profileId">FWF-000000</div>
      </div>
    </div>

    <div class="grid-2">
      <div class="content-card">
        <h3><i class="fa-solid fa-user-pen"></i> Edit Profile</h3>
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" class="form-input" id="editName" placeholder="Your name">
        </div>
        <div class="form-group">
          <label>Bio</label>
          <textarea class="form-input" id="editBio" placeholder="Something about yourself..." rows="3" style="resize:vertical"></textarea>
        </div>
        <button class="btn btn-primary" id="saveProfileBtn">
          <i class="fa-solid fa-save"></i> Save Changes
        </button>
      </div>

      <div class="content-card">
        <h3><i class="fa-solid fa-circle-info"></i> Account Info</h3>
        <div style="display:flex;flex-direction:column;gap:14px">
          <div>
            <div style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:2px">Mobile</div>
            <div style="font-weight:700" id="profileMobile">‚Äî</div>
          </div>
          <div>
            <div style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:2px">Email</div>
            <div style="font-weight:700" id="profileEmail">‚Äî</div>
          </div>
          <div>
            <div style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:2px">Member Since</div>
            <div style="font-weight:700" id="profileSince">‚Äî</div>
          </div>
          <div>
            <div style="font-size:12px;color:var(--text-muted);font-weight:600;margin-bottom:2px">Referral Code</div>
            <div style="font-weight:700;font-family:monospace;color:var(--accent)" id="profileRefCode">‚Äî</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== STORE PAGE ===================== -->
  <div class="page" id="page-store">
    <div class="content-card">
      <div class="store-placeholder">
        <i class="fa-solid fa-store"></i>
        <h3>FWF Store ‚Äî Coming Soon!</h3>
        <p style="max-width:400px;margin:0 auto;font-size:14px;line-height:1.7">
          Soon you'll be able to redeem your points for exclusive FWF merchandise,
          training materials, and special rewards. Stay tuned!
        </p>
        <div style="margin-top:24px">
          <div style="font-size:14px;color:var(--text-secondary);font-weight:700">Your redeemable points</div>
          <div style="font-size:42px;font-weight:900;color:var(--accent);margin-top:8px" id="storePoints">0</div>
          <div style="font-size:13px;color:var(--text-muted);font-weight:600">worth ‚Çπ<span id="storeValue">0</span></div>
        </div>
      </div>
    </div>
  </div>

</main>

<!-- ======== WELCOME LETTER MODAL ======== -->
<div class="welcome-overlay hidden" id="welcomeModal">
  <div class="welcome-letter">
    <img src="assets/images/logo.png" class="wl-logo" alt="FWF">
    <h2>Welcome to FWF!</h2>
    <div class="wl-name" id="wlName">Dear Member</div>
    <div class="wl-body">
      <p>Congratulations on joining the <strong>Foundation for Women's Future</strong>! üéâ</p>
      <br>
      <p>You are now part of a movement that empowers women through skills, livelihood,
      and community support. Together, we can create lasting change.</p>
      <br>
      <p><strong>Here's what you can do:</strong></p>
      <ul style="margin:8px 0 0 20px;list-style:disc">
        <li>Collect donations and earn <strong>10% as points</strong></li>
        <li>Refer new members and earn <strong>50% referral points</strong></li>
        <li>Sell quiz tickets and earn <strong>10% as points</strong></li>
        <li>Redeem points in the <strong>FWF Store</strong> (coming soon)</li>
      </ul>
    </div>
    <div class="wl-id" id="wlMemberId"><i class="fa-solid fa-id-card"></i> FWF-000000</div>
    <br>
    <button class="wl-btn" id="welcomeDismiss">
      <i class="fa-solid fa-rocket"></i> Let's Get Started!
    </button>
  </div>
</div>

<script src="assets/js/fwf.js"></script>
<script src="auth.js"></script>
<script>
/* ============================================
   THEME SYSTEM ‚Äî Morning / Afternoon / Evening
   ============================================ */
function getTimeTheme(){
  const h = new Date().getHours();
  if(h >= 5 && h < 12) return 'morning';
  if(h >= 12 && h < 17) return 'afternoon';
  return 'evening';
}
function applyTheme(){
  const theme = getTimeTheme();
  document.documentElement.setAttribute('data-theme', theme);
  const icons = { morning:'üåÖ', afternoon:'‚òÄÔ∏è', evening:'üåô' };
  const labels = { morning:'Good Morning', afternoon:'Good Afternoon', evening:'Good Evening' };
  document.getElementById('themeIcon').textContent = icons[theme];
  return labels[theme];
}
const greetLabel = applyTheme();
setInterval(applyTheme, 5*60*1000);

/* ============================================
   NAVIGATION
   ============================================ */
let currentPage = 'home';
function switchPage(page){
  currentPage = page;
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item[data-page]').forEach(n => n.classList.remove('active'));
  const target = document.getElementById('page-' + page);
  if(target) target.classList.add('active');
  const nav = document.querySelector('.nav-item[data-page="'+page+'"]');
  if(nav) nav.classList.add('active');
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('mobileOverlay').classList.remove('show');
}
document.querySelectorAll('.nav-item[data-page]').forEach(btn => {
  btn.addEventListener('click', () => switchPage(btn.dataset.page));
});
document.getElementById('mobileToggle').addEventListener('click', () => {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('mobileOverlay').classList.toggle('show');
});
document.getElementById('mobileOverlay').addEventListener('click', () => {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('mobileOverlay').classList.remove('show');
});

/* ============================================
   DATA LOADING
   ============================================ */
let memberData = null;

async function loadDashboard(){
  try {
    const data = await AUTH.api('/api/member/me');
    memberData = data;
    renderDashboard(data);
  } catch(e) {
    if(typeof FWF_Notify !== 'undefined') FWF_Notify.toast('Session expired. Redirecting...', 'error');
    setTimeout(() => location.href = '/member-login', 2000);
  }
}

function renderDashboard(data){
  const { user, wallet, project, referralStats, recentDonations, quizStats, recentPoints, pointInfo } = data;
  const w = wallet || {};
  const pts = w.points_balance || 0;
  const ptsDon = w.points_from_donations || 0;
  const ptsRef = w.points_from_referrals || 0;
  const ptsQuiz = w.points_from_quiz || 0;
  const pv = (pointInfo && pointInfo.pointValue) || 10;
  const rs = referralStats || {};

  // Greeting
  document.getElementById('greetingText').textContent = greetLabel + ', ' + (user.name || 'Member') + '!';
  document.getElementById('greetingSub').textContent = "Here's your dashboard overview";
  document.getElementById('topMemberId').textContent = user.member_id;

  // Home stats
  document.getElementById('homePoints').textContent = fmtN(pts);
  document.getElementById('homeDonPts').textContent = fmtN(ptsDon);
  document.getElementById('homeRefPts').textContent = fmtN(ptsRef);
  document.getElementById('homeQuizPts').textContent = fmtN(ptsQuiz);

  // Referral
  document.getElementById('homeRefCode').textContent = user.referral_code || '‚Äî';
  document.getElementById('homeRefTotal').textContent = rs.total || 0;
  document.getElementById('homeRefActive').textContent = rs.active || 0;

  // Recent activity
  renderPointsTable('homeActivity', recentPoints);

  // Projects page
  document.getElementById('projWbal').textContent = fmtN(w.balance_inr);
  document.getElementById('projTgt').textContent = project ? fmtN(project.target60_inr) : '0';
  document.getElementById('projApplied').textContent = project ? fmtN(project.wallet_applied_inr) : '0';

  // Wallet page
  document.getElementById('walletPtsBalance').textContent = fmtN(pts);
  document.getElementById('walletPtsValue').textContent = fmtN(pts * pv);
  document.getElementById('walletDonPts').textContent = fmtP(ptsDon);
  document.getElementById('walletRefPts').textContent = fmtP(ptsRef);
  document.getElementById('walletQuizPts').textContent = fmtP(ptsQuiz);
  renderPointsTable('walletHistory', recentPoints);

  // Profile page
  const initials = (user.name || 'M').split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase();
  document.getElementById('profileAvatar').textContent = initials;
  document.getElementById('profileName').textContent = user.name || 'Member';
  document.getElementById('profileId').textContent = user.member_id;
  document.getElementById('editName').value = user.name || '';
  document.getElementById('editBio').value = user.bio || '';
  document.getElementById('profileMobile').textContent = user.mobile || '‚Äî';
  document.getElementById('profileEmail').textContent = user.email || '‚Äî';
  document.getElementById('profileSince').textContent = formatDate(user.created_at);
  document.getElementById('profileRefCode').textContent = user.referral_code || '‚Äî';

  // Store page
  document.getElementById('storePoints').textContent = fmtN(pts);
  document.getElementById('storeValue').textContent = fmtN(pts * pv);

  // Welcome letter
  if(!user.first_login_done){
    document.getElementById('wlName').textContent = 'Dear ' + (user.name || 'Member') + ',';
    document.getElementById('wlMemberId').innerHTML = '<i class="fa-solid fa-id-card"></i> ' + user.member_id;
    document.getElementById('welcomeModal').classList.remove('hidden');
  }
}

function renderPointsTable(tbodyId, points){
  const tbody = document.getElementById(tbodyId);
  if(points && points.length > 0){
    tbody.innerHTML = points.map(r => {
      const badgeClass = r.type === 'donation' ? 'badge-donation' : r.type === 'referral' ? 'badge-referral' : r.type === 'quiz' ? 'badge-quiz' : 'badge-pending';
      return '<tr>' +
        '<td><span class="badge '+badgeClass+'">'+r.type+'</span></td>' +
        '<td style="font-weight:800;color:var(--accent)">+'+fmtP(r.points)+'</td>' +
        '<td>'+(r.description||'‚Äî')+'</td>' +
        '<td>'+formatDate(r.created_at)+'</td>' +
      '</tr>';
    }).join('');
  } else {
    tbody.innerHTML = '<tr><td colspan="4" class="empty-row">No activity yet. Start earning points!</td></tr>';
  }
}

function fmtN(n){ return Math.round(n || 0).toLocaleString('en-IN'); }
function fmtP(n){ return (n || 0) % 1 === 0 ? Math.round(n||0) : (n||0).toFixed(1); }
function formatDate(d){
  if(!d) return '‚Äî';
  try { return new Date(d).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'}); }
  catch(e){ return d; }
}

/* ============================================
   ACTIONS
   ============================================ */
document.getElementById('welcomeDismiss').addEventListener('click', async ()=>{
  document.getElementById('welcomeModal').classList.add('hidden');
  try { await AUTH.api('/api/member/welcome-done',{method:'POST'}); } catch(e){}
});

document.getElementById('applyWalletBtn').addEventListener('click', async ()=>{
  const amt = parseFloat(document.getElementById('applyAmount').value);
  if(!amt || amt <= 0) return notify('Enter a valid amount','warning');
  try {
    await AUTH.api('/api/member/apply-wallet',{method:'POST',body:{amount:amt}});
    notify('‚Çπ'+amt+' applied to project!','success');
    document.getElementById('applyAmount').value = '';
    loadDashboard();
  } catch(e){ notify(e.message||'Failed','error'); }
});

document.getElementById('recordDonationBtn').addEventListener('click', async ()=>{
  const amt = parseFloat(document.getElementById('donationAmt').value);
  if(!amt || amt <= 0) return notify('Enter donation amount','warning');
  const donorName = document.getElementById('donorName').value.trim();
  const donorContact = document.getElementById('donorContact').value.trim();
  try {
    const r = await AUTH.api('/api/member/record-donation',{method:'POST',body:{amount:amt,donorName,donorContact}});
    notify(r.message || 'Earned '+r.points+' points!','success');
    document.getElementById('donationAmt').value = '';
    document.getElementById('donorName').value = '';
    document.getElementById('donorContact').value = '';
    loadDashboard();
  } catch(e){ notify(e.message||'Failed','error'); }
});

document.getElementById('sellTicketBtn').addEventListener('click', async ()=>{
  const buyerName = document.getElementById('ticketBuyer').value.trim();
  const buyerContact = document.getElementById('ticketContact').value.trim();
  if(!buyerName) return notify('Enter buyer name','warning');
  try {
    const r = await AUTH.api('/api/member/sell-ticket',{method:'POST',body:{buyerName,buyerContact}});
    notify(r.message || 'Earned '+r.points+' points!','success');
    document.getElementById('ticketBuyer').value = '';
    document.getElementById('ticketContact').value = '';
    loadDashboard();
  } catch(e){ notify(e.message||'Failed','error'); }
});

document.getElementById('saveProfileBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('editName').value.trim();
  const bio = document.getElementById('editBio').value.trim();
  try {
    await AUTH.api('/api/member/update-profile',{method:'POST',body:{name,bio}});
    notify('Profile updated!','success');
    loadDashboard();
  } catch(e){ notify(e.message||'Failed','error'); }
});

function copyReferralLink(){
  const code = memberData && memberData.user && memberData.user.referral_code;
  if(!code) return notify('No referral code','warning');
  const link = location.origin + '/join?ref=' + code;
  navigator.clipboard.writeText(link).then(()=>{
    notify('Referral link copied!','success');
  }).catch(()=>{ prompt('Copy this link:', link); });
}

document.getElementById('logoutBtn').addEventListener('click', ()=>{
  if(typeof FWF_Notify !== 'undefined'){
    FWF_Notify.confirm('Are you sure you want to logout?', async ()=>{
      await AUTH.api('/api/auth/logout',{method:'POST'});
      notify('Logged out','success');
      setTimeout(()=> location.href = '/', 1000);
    });
  } else {
    if(confirm('Logout?')){
      AUTH.api('/api/auth/logout',{method:'POST'}).finally(()=> location.href = '/');
    }
  }
});

function notify(msg, type){
  if(typeof FWF_Notify !== 'undefined') FWF_Notify.toast(msg, type);
  else alert(msg);
}

loadDashboard();
</script>
</body>
</html>
