<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FWF — Luxury Artisan Store</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/images/logo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/images/logo.png">
  <link rel="apple-touch-icon" href="assets/images/logo.png">
  <link rel="shortcut icon" href="assets/images/logo.png">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,500&family=Montserrat:wght@300;400;500;600;700&family=EB+Garamond:ital@0;1&display=swap" rel="stylesheet"/>

  <style>
  :root{
    --ink:#1e293b; --muted:#64748b; --soft:#f1f5f9; --card:#ffffff; --brd:#e2e8f0;
    --gA:#60a5fa; --gB:#a78bfa; --gC:#22c55e; --gD:#22d3ee; --gE:#f59e0b; --gF:#ef4444;
    --deep:#0f172a; --accent:#22c55e; --radius:16px;
    --shadow:0 4px 24px rgba(15,23,42,.06);
    --shadow-lg:0 16px 48px rgba(15,23,42,.1);
  }
  html{ scroll-behavior:smooth }
  body{
    margin:0; font-family:'Plus Jakarta Sans',system-ui,sans-serif; color:var(--ink);
    background:#f8fafc; padding-top:72px; overflow-x:hidden; letter-spacing:.01em
  }
  *{ box-sizing:border-box } a{ color:inherit; text-decoration:none }
  .container{ width:100%; max-width:1280px; margin:0 auto; padding:0 20px }
  html[data-lang="hi"] body{font-family:'Noto Sans Devanagari','Mukta','Plus Jakarta Sans',system-ui,sans-serif}

  /* =============== HEADER =============== */
  .header{
    position:fixed; inset:0 0 auto 0; height:72px; z-index:200;
    display:flex; align-items:center; justify-content:center;
    background:rgba(255,255,255,.88); backdrop-filter:blur(16px) saturate(150%);
    border-bottom:1px solid var(--brd); transition:all .25s
  }
  .header.scrolled{ box-shadow:0 4px 20px rgba(15,23,42,.06); height:64px }
  .header .H{
    max-width:1280px; width:100%; padding:0 20px;
    display:flex; align-items:center; justify-content:space-between
  }
  .brand{ display:flex; align-items:center; gap:8px }
  .brand img{ width:48px; height:48px; object-fit:contain; border-radius:12px }

  /* Nav links */
  nav{ display:flex; align-items:center; gap:6px }
  .navList{ display:flex; gap:4px; list-style:none; margin:0; padding:0 }
  .navList a{
    display:inline-flex; align-items:center; padding:8px 16px; border-radius:10px;
    font-weight:700; font-size:.92rem; color:var(--ink); position:relative; transition:.18s
  }
  .navList a:hover{ background:rgba(15,23,42,.05) }
  .navList a.active{ color:var(--gA) }
  .navList a.active::after{
    content:""; position:absolute; bottom:4px; left:16px; right:16px; height:2.5px;
    border-radius:2px; background:linear-gradient(90deg,var(--gA),var(--gB))
  }

  /* Header action icons */
  .header-actions{ display:flex; align-items:center; gap:6px }
  .icon-btn{
    position:relative; width:42px; height:42px; border-radius:12px; border:none;
    background:transparent; cursor:pointer; display:flex; align-items:center; justify-content:center;
    font-size:1.15rem; color:var(--ink); transition:.18s
  }
  .icon-btn:hover{ background:var(--soft) }
  .icon-btn .badge-count{
    position:absolute; top:4px; right:4px; min-width:18px; height:18px; padding:0 5px;
    border-radius:9px; background:var(--gF); color:#fff; font-size:.65rem; font-weight:800;
    display:none; align-items:center; justify-content:center; line-height:1
  }
  .icon-btn .badge-count.show{ display:flex }

  /* Nav toggle (mobile) */
  .navToggle{ display:none; background:none; border:none; font-size:1.35rem; cursor:pointer; color:var(--ink); padding:8px }
  @media(max-width:900px){
    .navToggle{ display:block }
    nav{ position:fixed; top:72px; left:0; right:0; background:#fff; flex-direction:column; display:none; border-bottom:1px solid var(--brd); z-index:199; box-shadow:0 8px 24px rgba(0,0,0,.08) }
    nav.open{ display:flex }
    .navList{ flex-direction:column; gap:0; padding:8px 0 }
    .navList a{ padding:14px 24px; width:100%; border-radius:0; font-size:1rem }
    .navList a.active::after{ display:none }
  }

  /* =============== IMPACT BANNER =============== */
  .impact-banner{
    background:linear-gradient(135deg,var(--deep) 0%,#1a1040 50%,#0c2340 100%); position:relative;
    overflow:hidden; border-bottom:1px solid rgba(96,165,250,.1)
  }
  .impact-banner::before{
    content:""; position:absolute; top:-50%; right:-10%; width:300px; height:300px;
    background:radial-gradient(circle,rgba(96,165,250,.12),transparent 70%); border-radius:50%
  }
  .impact-content{
    position:relative; z-index:1; display:grid; grid-template-columns:1fr auto; gap:24px;
    align-items:center; padding:24px 0
  }
  .impact-text{ display:flex; flex-direction:column; gap:8px }
  .impact-headline{
    font-size:1.35rem; font-weight:900; color:#fff; margin:0;
    background:linear-gradient(90deg,#fff,var(--gA)); -webkit-background-clip:text;
    background-clip:text; -webkit-text-fill-color:transparent; line-height:1.3
  }
  .impact-desc{
    color:#94a3b8; font-size:.92rem; margin:0; max-width:580px; line-height:1.5
  }
  .impact-badge{
    display:inline-flex; align-items:center; gap:8px; background:rgba(34,197,94,.12);
    color:var(--gC); font-size:.82rem; font-weight:700; padding:8px 16px; border-radius:30px;
    border:1px solid rgba(34,197,94,.2); backdrop-filter:blur(8px); margin-top:6px;
    align-self:flex-start
  }
  .impact-badge i{ font-size:1rem }
  .impact-stats{
    display:flex; gap:32px; align-items:center; padding-right:12px
  }
  .impact-stat{ text-align:center; min-width:80px }
  .impact-stat .num{
    font-size:1.8rem; font-weight:900; color:#fff; line-height:1;
    background:linear-gradient(135deg,var(--gA),var(--gD)); -webkit-background-clip:text;
    background-clip:text; -webkit-text-fill-color:transparent
  }
  .impact-stat .lbl{
    font-size:.72rem; color:#64748b; text-transform:uppercase; letter-spacing:.06em;
    font-weight:600; margin-top:4px
  }
  @media(max-width:900px){
    .impact-content{ grid-template-columns:1fr; gap:16px }
    .impact-stats{ gap:24px; justify-content:center; padding:12px 0 0 }
  }

  /* =============== SEARCH + FILTERS =============== */
  .search-section{
    background:var(--card); border-bottom:1px solid var(--brd); padding:18px 0;
    position:sticky; top:72px; z-index:100; transition:top .25s;
    box-shadow:0 2px 12px rgba(15,23,42,.04)
  }
  .header.scrolled ~ .search-section{ top:64px }
  .search-wrapper{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap }
  .search-bar{ display:flex; gap:10px; align-items:center; flex:1; min-width:320px; max-width:600px }
  .search-bar input{
    flex:1; padding:12px 18px; border-radius:12px; border:2px solid var(--brd);
    font-size:.95rem; font-family:inherit; outline:none; transition:.2s; background:var(--soft)
  }
  .search-bar input:focus{ border-color:var(--gA); box-shadow:0 0 0 3px rgba(96,165,250,.12); background:#fff }
  .search-bar button{
    padding:12px 24px; border:none; border-radius:12px;
    background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff;
    font-weight:700; font-size:.92rem; cursor:pointer; transition:.2s; white-space:nowrap
  }
  .search-bar button:hover{ box-shadow:0 6px 20px rgba(96,165,250,.25); transform:translateY(-1px) }
  .view-toggle{ display:flex; gap:6px; align-items:center }
  .view-toggle span{ font-size:.85rem; color:var(--muted); font-weight:600 }
  @media(max-width:780px){ .search-wrapper{ flex-direction:column; align-items:stretch } .search-bar{ max-width:100% } }

  /* =============== MAIN LAYOUT =============== */
  .store-layout{
    display:grid; grid-template-columns:240px 1fr; gap:24px; padding:24px 0 60px; min-height:60vh
  }
  @media(max-width:900px){ .store-layout{ grid-template-columns:1fr } }

  /* =============== SIDEBAR CATEGORIES =============== */
  .cat-sidebar{
    background:var(--card); border-radius:var(--radius); padding:20px; border:1px solid var(--brd);
    height:fit-content; position:sticky; top:155px; box-shadow:var(--shadow)
  }
  .cat-sidebar h3{
    margin:0 0 14px; font-size:.82rem; color:var(--muted); font-weight:800;
    text-transform:uppercase; letter-spacing:.08em
  }
  .cat-item{
    display:flex; align-items:center; gap:10px; padding:9px 12px; border-radius:10px;
    cursor:pointer; font-weight:600; font-size:.88rem; transition:.15s; color:var(--ink)
  }
  .cat-item:hover{ background:rgba(96,165,250,.06) }
  .cat-item.active{ background:linear-gradient(135deg,rgba(96,165,250,.08),rgba(167,139,250,.08)); color:var(--gA) }
  .cat-item i{ width:20px; text-align:center; font-size:.92rem; color:var(--muted) }
  .cat-item.active i{ color:var(--gA) }
  .cat-item .count{
    margin-left:auto; font-size:.72rem; color:var(--muted);
    background:var(--soft); padding:2px 8px; border-radius:20px; font-weight:700
  }
  .cat-subs{ padding-left:30px; display:none }
  .cat-item.active + .cat-subs{ display:block }
  .cat-sub{
    padding:6px 12px; font-size:.82rem; border-radius:8px; cursor:pointer;
    font-weight:600; transition:.15s; color:var(--muted)
  }
  .cat-sub:hover, .cat-sub.active{ color:var(--gA); background:rgba(96,165,250,.06) }
  @media(max-width:900px){ .cat-sidebar{ display:none } .cat-mobile{ display:flex !important } }

  .cat-mobile{
    display:none; overflow-x:auto; gap:8px; padding:0 0 12px; scrollbar-width:none; -webkit-overflow-scrolling:touch
  }
  .cat-mobile::-webkit-scrollbar{ display:none }
  .cat-chip{
    flex-shrink:0; padding:8px 16px; border-radius:30px; border:2px solid var(--brd);
    background:var(--card); font-weight:700; font-size:.82rem; cursor:pointer; transition:.18s; white-space:nowrap
  }
  .cat-chip:hover{ border-color:var(--gA); color:var(--gA) }
  .cat-chip.active{ background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff; border-color:transparent }

  /* =============== PRODUCT GRID =============== */
  .products-area{ min-width:0 }
  .products-bar{
    display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; flex-wrap:wrap; gap:8px
  }
  .products-bar .count{ font-weight:700; color:var(--muted); font-size:.9rem }
  .products-bar select{
    padding:8px 14px; border-radius:10px; border:2px solid var(--brd); font-family:inherit;
    font-weight:600; background:var(--card); cursor:pointer; outline:none; font-size:.88rem
  }
  .product-grid{
    display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px
  }
  @media(max-width:560px){ .product-grid{ grid-template-columns:repeat(2,1fr); gap:10px } }

  .product-card{
    background:var(--card); border-radius:var(--radius); border:1px solid var(--brd); overflow:hidden;
    transition:.25s; cursor:pointer; position:relative; box-shadow:var(--shadow)
  }
  .product-card:hover{ transform:translateY(-6px); box-shadow:var(--shadow-lg) }
  .product-card .badge{
    position:absolute; top:10px; left:10px; background:linear-gradient(135deg,var(--gC),var(--gD));
    color:#fff; font-size:.65rem; font-weight:800; padding:4px 10px; border-radius:8px; z-index:2;
    text-transform:uppercase; letter-spacing:.04em
  }
  .product-card .wishlist-btn{
    position:absolute; top:10px; right:10px; width:34px; height:34px; border-radius:50%;
    background:rgba(255,255,255,.9); border:none; cursor:pointer; z-index:3;
    display:flex; align-items:center; justify-content:center; font-size:.92rem; color:var(--muted);
    transition:.2s; backdrop-filter:blur(4px); box-shadow:0 2px 8px rgba(0,0,0,.1)
  }
  .product-card .wishlist-btn:hover{ color:var(--gF); transform:scale(1.1) }
  .product-card .wishlist-btn.wishlisted{ color:var(--gF) }
  .product-card .img-wrap{
    width:100%; aspect-ratio:1; background:var(--soft); display:flex; align-items:center; justify-content:center;
    overflow:hidden; position:relative
  }
  .product-card .img-wrap img{ width:100%; height:100%; object-fit:cover; transition:.4s }
  .product-card:hover .img-wrap img{ transform:scale(1.08) }
  .product-card .img-wrap .placeholder{ font-size:3rem; color:var(--brd) }
  .product-card .quick-actions{
    position:absolute; bottom:0; left:0; right:0; padding:10px; display:flex; gap:8px;
    transform:translateY(100%); transition:.25s; background:linear-gradient(transparent,rgba(0,0,0,.4))
  }
  .product-card:hover .quick-actions{ transform:translateY(0) }
  .quick-actions .btn-add-cart{
    flex:1; padding:8px; border:none; border-radius:8px;
    background:rgba(255,255,255,.95); color:var(--ink); font-weight:700; font-size:.78rem;
    cursor:pointer; transition:.15s; backdrop-filter:blur(4px)
  }
  .quick-actions .btn-add-cart:hover{ background:#fff }
  .product-card .info{ padding:14px }
  .product-card .cat-label{
    font-size:.68rem; font-weight:700; color:var(--gA); text-transform:uppercase;
    letter-spacing:.05em; margin-bottom:3px
  }
  .product-card .title{
    font-weight:800; font-size:.9rem; line-height:1.35; margin-bottom:5px;
    display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden
  }
  .product-card .seller{ font-size:.75rem; color:var(--muted); margin-bottom:8px }
  .product-card .price-row{ display:flex; align-items:baseline; gap:6px; flex-wrap:wrap }
  .product-card .price{ font-weight:900; font-size:1.1rem; color:var(--ink) }
  .product-card .mrp{ font-size:.82rem; color:var(--muted); text-decoration:line-through }
  .product-card .discount{ font-size:.75rem; font-weight:800; color:var(--gC) }
  .product-card .rating{
    display:flex; align-items:center; gap:4px; margin-top:6px;
    font-size:.78rem; color:var(--gE); font-weight:700
  }
  .product-card .rating .count{ color:var(--muted); font-weight:600 }

  /* =============== EMPTY STATE =============== */
  .empty-state{ text-align:center; padding:60px 20px; color:var(--muted) }
  .empty-state i{ font-size:3rem; margin-bottom:12px; opacity:.35 }
  .empty-state h3{ font-size:1.15rem; margin:0 0 6px; color:var(--ink) }
  .empty-state p{ font-size:.92rem }

  /* =============== PRODUCT DETAIL MODAL =============== */
  .modal-overlay{
    display:none; position:fixed; inset:0; z-index:1000; background:rgba(15,23,42,.6);
    backdrop-filter:blur(8px); justify-content:center; align-items:flex-start; padding:40px 16px; overflow-y:auto
  }
  .modal-overlay.show{ display:flex }
  .modal-content{
    background:var(--card); border-radius:20px; max-width:900px; width:100%; margin:auto;
    box-shadow:0 30px 60px rgba(0,0,0,.2); overflow:hidden; animation:slideUp .3s ease
  }
  @keyframes slideUp{ from{ opacity:0; transform:translateY(30px) } to{ opacity:1; transform:translateY(0) } }
  .modal-close{
    position:absolute; top:16px; right:16px; width:38px; height:38px; border-radius:10px;
    background:rgba(15,23,42,.06); border:none; font-size:1.1rem; cursor:pointer; z-index:10; transition:.15s
  }
  .modal-close:hover{ background:rgba(15,23,42,.12) }
  .modal-body{ display:grid; grid-template-columns:1fr 1fr; gap:0; position:relative }
  @media(max-width:700px){ .modal-body{ grid-template-columns:1fr } }

  .modal-gallery{ background:var(--soft); padding:24px; display:flex; flex-direction:column; gap:12px }
  .modal-gallery .main-img{
    width:100%; aspect-ratio:1; border-radius:14px; overflow:hidden;
    background:#fff; display:flex; align-items:center; justify-content:center
  }
  .modal-gallery .main-img img{ max-width:100%; max-height:100%; object-fit:contain }
  .modal-gallery .thumbs{ display:flex; gap:8px; overflow-x:auto }
  .modal-gallery .thumb{
    width:56px; height:56px; border-radius:10px; border:2px solid transparent; overflow:hidden;
    cursor:pointer; flex-shrink:0; background:#fff; transition:.15s
  }
  .modal-gallery .thumb.active{ border-color:var(--gA) }
  .modal-gallery .thumb img{ width:100%; height:100%; object-fit:cover }

  .modal-details{ padding:28px 24px; display:flex; flex-direction:column; gap:12px }
  .modal-details .cat-label{ font-size:.75rem; font-weight:700; color:var(--gA); text-transform:uppercase; letter-spacing:.05em }
  .modal-details h2{ margin:0; font-size:1.4rem; font-weight:900; line-height:1.3 }
  .modal-details .seller-info{ font-size:.88rem; color:var(--muted) }
  .modal-details .price-section{ display:flex; align-items:baseline; gap:10px; flex-wrap:wrap }
  .modal-details .price-section .price{ font-size:1.5rem; font-weight:900 }
  .modal-details .price-section .mrp{ font-size:1rem; color:var(--muted); text-decoration:line-through }
  .modal-details .price-section .discount{ font-size:.88rem; font-weight:800; color:var(--gC) }
  .modal-details .meta-grid{ display:grid; grid-template-columns:1fr 1fr; gap:8px }
  .modal-details .meta-item{ font-size:.85rem; color:var(--muted) }
  .modal-details .meta-item strong{ color:var(--ink) }
  .modal-details .desc{ font-size:.9rem; color:var(--muted); line-height:1.6 }
  .modal-details .stock-info{ font-size:.85rem; display:flex; align-items:center; gap:6px }
  .modal-details .stock-info.in-stock{ color:var(--gC) }
  .modal-details .stock-info.low-stock{ color:var(--gE) }

  /* Modal action buttons */
  .modal-actions{ display:flex; gap:10px; margin-top:4px }
  .modal-actions .btn-modal{
    flex:1; padding:11px 16px; border-radius:10px; border:none; cursor:pointer;
    font-weight:700; font-size:.88rem; transition:.2s; display:flex; align-items:center; justify-content:center; gap:6px
  }
  .btn-modal.cart-btn{ background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff }
  .btn-modal.cart-btn:hover{ box-shadow:0 6px 20px rgba(96,165,250,.3); transform:translateY(-1px) }
  .btn-modal.wish-btn{ background:var(--soft); color:var(--ink); border:1px solid var(--brd) }
  .btn-modal.wish-btn:hover{ border-color:var(--gF); color:var(--gF) }
  .btn-modal.wish-btn.wishlisted{ background:rgba(239,68,68,.06); color:var(--gF); border-color:rgba(239,68,68,.2) }

  /* ORDER FORM IN MODAL */
  .order-section{ border-top:1px solid var(--brd); padding-top:14px; margin-top:auto }
  .order-section h4{ margin:0 0 10px; font-size:.95rem }
  .order-form{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
  .order-form .full{ grid-column:1/-1 }
  .order-form input, .order-form textarea, .order-form select{
    padding:10px 14px; border:2px solid var(--brd); border-radius:10px; font-family:inherit;
    font-size:.88rem; outline:none; width:100%; transition:.2s
  }
  .order-form input:focus, .order-form textarea:focus{ border-color:var(--gA); box-shadow:0 0 0 3px rgba(96,165,250,.08) }
  .order-form textarea{ resize:vertical; min-height:60px }
  .order-form .qty-row{ display:flex; align-items:center; gap:8px }
  .order-form .qty-btn{
    width:34px; height:34px; border-radius:8px; border:2px solid var(--brd); background:#fff;
    font-size:1.1rem; font-weight:900; cursor:pointer; transition:.15s
  }
  .order-form .qty-btn:hover{ border-color:var(--gA); color:var(--gA) }
  .order-form .qty-val{ font-weight:900; font-size:1.1rem; min-width:30px; text-align:center }
  .btn-order{
    grid-column:1/-1; padding:12px; border:none; border-radius:12px;
    background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff;
    font-weight:800; font-size:.95rem; cursor:pointer; transition:.2s; margin-top:4px
  }
  .btn-order:hover{ box-shadow:0 8px 24px rgba(96,165,250,.3); transform:translateY(-1px) }
  .btn-order:disabled{ opacity:.5; cursor:not-allowed; transform:none }

  /* ORDER SUCCESS */
  .order-success{ text-align:center; padding:30px; display:none }
  .order-success.show{ display:block }
  .order-success i{ font-size:3rem; color:var(--gC); margin-bottom:12px }
  .order-success h3{ margin:0 0 6px; font-size:1.2rem }
  .order-success p{ color:var(--muted) }

  /* =============== CART DRAWER =============== */
  .cart-overlay{
    display:none; position:fixed; inset:0; z-index:900; background:rgba(15,23,42,.45);
    backdrop-filter:blur(4px); transition:.3s
  }
  .cart-overlay.open{ display:block }
  .cart-drawer{
    position:fixed; top:0; right:-420px; width:400px; max-width:92vw; height:100vh; z-index:901;
    background:var(--card); box-shadow:-8px 0 40px rgba(0,0,0,.12); display:flex; flex-direction:column;
    transition:right .35s cubic-bezier(.4,0,.2,1)
  }
  .cart-drawer.open{ right:0 }
  .cart-header{
    display:flex; align-items:center; justify-content:space-between; padding:20px 22px;
    border-bottom:1px solid var(--brd)
  }
  .cart-header h3{ margin:0; font-size:1.1rem; font-weight:900; display:flex; align-items:center; gap:8px }
  .cart-header h3 .cart-count-lbl{
    background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff;
    font-size:.72rem; padding:2px 8px; border-radius:12px
  }
  .cart-close{
    width:36px; height:36px; border-radius:10px; border:none; background:var(--soft);
    cursor:pointer; font-size:1rem; transition:.15s
  }
  .cart-close:hover{ background:var(--brd) }
  .cart-items{ flex:1; overflow-y:auto; padding:16px 22px }
  .cart-empty{ text-align:center; padding:40px 0; color:var(--muted) }
  .cart-empty i{ font-size:2.5rem; opacity:.3; margin-bottom:10px; display:block }
  .cart-item{
    display:flex; gap:14px; padding:14px 0; border-bottom:1px solid var(--brd)
  }
  .cart-item:last-child{ border-bottom:none }
  .cart-item-img{
    width:72px; height:72px; border-radius:10px; background:var(--soft);
    overflow:hidden; flex-shrink:0
  }
  .cart-item-img img{ width:100%; height:100%; object-fit:cover }
  .cart-item-info{ flex:1; min-width:0 }
  .cart-item-info .name{ font-weight:700; font-size:.88rem; margin-bottom:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .cart-item-info .meta{ font-size:.78rem; color:var(--muted); margin-bottom:6px }
  .cart-item-qty{ display:flex; align-items:center; gap:6px }
  .cart-item-qty button{
    width:26px; height:26px; border-radius:6px; border:1px solid var(--brd); background:#fff;
    font-weight:900; cursor:pointer; font-size:.85rem; transition:.15s
  }
  .cart-item-qty button:hover{ border-color:var(--gA); color:var(--gA) }
  .cart-item-qty span{ font-weight:800; font-size:.88rem; min-width:20px; text-align:center }
  .cart-item-price{ font-weight:900; font-size:.95rem; margin-left:auto; white-space:nowrap }
  .cart-item-remove{
    align-self:flex-start; width:28px; height:28px; border:none; background:none;
    color:var(--muted); cursor:pointer; font-size:.85rem; transition:.15s; border-radius:6px; flex-shrink:0
  }
  .cart-item-remove:hover{ color:var(--gF); background:rgba(239,68,68,.06) }
  .cart-footer{ border-top:1px solid var(--brd); padding:18px 22px }
  .cart-total{
    display:flex; justify-content:space-between; align-items:center; margin-bottom:14px
  }
  .cart-total .label{ font-weight:700; color:var(--muted) }
  .cart-total .amount{ font-size:1.3rem; font-weight:900 }
  .cart-checkout{
    width:100%; padding:13px; border:none; border-radius:12px;
    background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff;
    font-weight:800; font-size:.95rem; cursor:pointer; transition:.2s
  }
  .cart-checkout:hover{ box-shadow:0 8px 24px rgba(96,165,250,.3); transform:translateY(-1px) }
  .cart-checkout:disabled{ opacity:.5; cursor:not-allowed; transform:none }

  /* =============== WISHLIST DRAWER =============== */
  .wish-overlay{
    display:none; position:fixed; inset:0; z-index:900; background:rgba(15,23,42,.45);
    backdrop-filter:blur(4px)
  }
  .wish-overlay.open{ display:block }
  .wish-drawer{
    position:fixed; top:0; right:-420px; width:400px; max-width:92vw; height:100vh; z-index:901;
    background:var(--card); box-shadow:-8px 0 40px rgba(0,0,0,.12); display:flex; flex-direction:column;
    transition:right .35s cubic-bezier(.4,0,.2,1)
  }
  .wish-drawer.open{ right:0 }
  .wish-header{
    display:flex; align-items:center; justify-content:space-between; padding:20px 22px;
    border-bottom:1px solid var(--brd)
  }
  .wish-header h3{ margin:0; font-size:1.1rem; font-weight:900; display:flex; align-items:center; gap:8px }
  .wish-header h3 .wish-count-lbl{
    background:linear-gradient(135deg,var(--gF),var(--gE)); color:#fff;
    font-size:.72rem; padding:2px 8px; border-radius:12px
  }
  .wish-close{
    width:36px; height:36px; border-radius:10px; border:none; background:var(--soft);
    cursor:pointer; font-size:1rem; transition:.15s
  }
  .wish-close:hover{ background:var(--brd) }
  .wish-items{ flex:1; overflow-y:auto; padding:16px 22px }
  .wish-empty{ text-align:center; padding:40px 0; color:var(--muted) }
  .wish-empty i{ font-size:2.5rem; opacity:.3; margin-bottom:10px; display:block }
  .wish-item{
    display:flex; gap:14px; padding:14px 0; border-bottom:1px solid var(--brd); align-items:center
  }
  .wish-item:last-child{ border-bottom:none }
  .wish-item-img{
    width:64px; height:64px; border-radius:10px; background:var(--soft);
    overflow:hidden; flex-shrink:0; cursor:pointer
  }
  .wish-item-img img{ width:100%; height:100%; object-fit:cover }
  .wish-item-info{ flex:1; min-width:0; cursor:pointer }
  .wish-item-info .name{ font-weight:700; font-size:.88rem; margin-bottom:2px }
  .wish-item-info .price{ font-weight:900; font-size:.92rem }
  .wish-item-actions{ display:flex; gap:6px }
  .wish-item-actions button{
    width:32px; height:32px; border-radius:8px; border:1px solid var(--brd); background:#fff;
    cursor:pointer; font-size:.82rem; transition:.15s
  }
  .wish-item-actions .to-cart:hover{ border-color:var(--gA); color:var(--gA); background:rgba(96,165,250,.06) }
  .wish-item-actions .remove-wish:hover{ border-color:var(--gF); color:var(--gF); background:rgba(239,68,68,.06) }

  /* =============== PAGINATION =============== */
  .pagination{ display:flex; justify-content:center; gap:6px; margin-top:30px; flex-wrap:wrap }
  .pagination button{
    padding:8px 14px; border-radius:10px; border:1px solid var(--brd); background:var(--card);
    font-weight:700; font-size:.88rem; cursor:pointer; transition:.18s
  }
  .pagination button:hover{ border-color:var(--gA); color:var(--gA) }
  .pagination button.active{ background:linear-gradient(135deg,var(--gA),var(--gB)); color:#fff; border-color:transparent }
  .pagination button:disabled{ opacity:.35; cursor:not-allowed }

  /* =============== LOADING & TOAST =============== */
  .loading{ text-align:center; padding:40px; color:var(--muted) }
  .loading i{ font-size:2rem; animation:spin 1s linear infinite }
  @keyframes spin{ to{ transform:rotate(360deg) } }

  .toast{
    position:fixed; bottom:30px; left:50%; transform:translateX(-50%) translateY(100px); z-index:2000;
    background:var(--deep); color:#fff; padding:12px 24px; border-radius:12px; font-weight:700;
    font-size:.9rem; box-shadow:0 10px 30px rgba(0,0,0,.2); transition:.3s; opacity:0; pointer-events:none
  }
  .toast.show{ transform:translateX(-50%) translateY(0); opacity:1 }

  /* =============== FOOTER =============== */
  .footer{
    background:var(--deep); color:#94a3b8; padding:28px 0; margin-top:40px; text-align:center; font-size:.88rem
  }
  </style>
</head>
<body>

<!-- HEADER -->
<div class="header" id="siteHeader">
  <div class="H">
    <a href="index.html" class="brand">
      <img src="assets/images/logo.png" alt="FWF"/>
    </a>
    <nav id="mainNav">
      <ul class="navList">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="projects.html">Projects</a></li>
        <li><a href="store.html" class="active">Store</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <button class="icon-btn" id="wishlistToggle" onclick="toggleWishDrawer()" title="Wishlist">
        <i class="far fa-heart"></i>
        <span class="badge-count" id="wishBadge">0</span>
      </button>
      <button class="icon-btn" id="cartToggle" onclick="toggleCartDrawer()" title="Cart">
        <i class="fas fa-shopping-bag"></i>
        <span class="badge-count" id="cartBadge">0</span>
      </button>
    </div>
    <button class="navToggle" id="navToggle" onclick="document.getElementById('mainNav').classList.toggle('open')"><i class="fas fa-bars"></i></button>
  </div>
</div>

<!-- IMPACT BANNER -->
<div class="impact-banner">
  <div class="container">
    <div class="impact-content">
      <div class="impact-text">
        <h1 class="impact-headline">Shop with Purpose • Empower with Every Purchase</h1>
        <p class="impact-desc">Each product creates sustainable livelihoods. Your purchase provides employment, dignity, and hope to unemployed artisans across India.</p>
        <div class="impact-badge"><i class="fas fa-hand-holding-heart"></i> Every purchase creates real employment opportunities</div>
      </div>
      <div class="impact-stats">
        <div class="impact-stat"><div class="num" id="heroTotal">--</div><div class="lbl">Products</div></div>
        <div class="impact-stat"><div class="num" id="heroCats">12</div><div class="lbl">Categories</div></div>
        <div class="impact-stat"><div class="num">100%</div><div class="lbl">Verified</div></div>
      </div>
    </div>
  </div>
</div>

<!-- SEARCH & FILTERS -->
<div class="search-section">
  <div class="container">
    <div class="search-wrapper">
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search handcrafted products, artisan goods, categories..." />
        <button onclick="searchProducts()"><i class="fas fa-search"></i> Search</button>
      </div>
      <div class="view-toggle">
        <span id="resultsCount">0 products</span>
      </div>
    </div>
  </div>
</div>

<!-- MAIN -->
<div class="container">
  <!-- MOBILE CATEGORIES -->
  <div class="cat-mobile" id="catMobile"></div>

  <div class="store-layout">
    <!-- SIDEBAR -->
    <aside class="cat-sidebar" id="catSidebar">
      <h3><i class="fas fa-th-large"></i> Categories</h3>
      <div class="cat-item active" data-cat="all" onclick="filterCategory('all',this)">
        <i class="fas fa-border-all"></i> All Products <span class="count" id="countAll">0</span>
      </div>
      <div id="catList"></div>
    </aside>

    <!-- PRODUCTS -->
    <div class="products-area">
      <div class="products-bar">
        <span class="count" style="opacity:0">--</span>
        <select id="sortSelect" onchange="loadProducts()">
          <option value="">Featured</option>
          <option value="newest">Newest First</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
          <option value="rating">Top Rated</option>
          <option value="popular">Most Popular</option>
        </select>
      </div>
      <div class="product-grid" id="productGrid">
        <div class="loading"><i class="fas fa-spinner"></i><br>Loading products...</div>
      </div>
      <div class="pagination" id="pagination"></div>
    </div>
  </div>
</div>

<!-- PRODUCT DETAIL MODAL -->
<div class="modal-overlay" id="productModal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeProductModal()"><i class="fas fa-times"></i></button>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<!-- CART DRAWER -->
<div class="cart-overlay" id="cartOverlay" onclick="toggleCartDrawer()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-header">
    <h3><i class="fas fa-shopping-bag"></i> Cart <span class="cart-count-lbl" id="cartCountLbl">0</span></h3>
    <button class="cart-close" onclick="toggleCartDrawer()"><i class="fas fa-times"></i></button>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-footer" id="cartFooter" style="display:none">
    <div class="cart-total">
      <span class="label">Total</span>
      <span class="amount" id="cartTotalAmount">&#8377;0</span>
    </div>
    <button class="cart-checkout" onclick="checkoutCart()"><i class="fas fa-lock"></i> Proceed to Checkout</button>
  </div>
</div>

<!-- WISHLIST DRAWER -->
<div class="wish-overlay" id="wishOverlay" onclick="toggleWishDrawer()"></div>
<div class="wish-drawer" id="wishDrawer">
  <div class="wish-header">
    <h3><i class="fas fa-heart"></i> Wishlist <span class="wish-count-lbl" id="wishCountLbl">0</span></h3>
    <button class="wish-close" onclick="toggleWishDrawer()"><i class="fas fa-times"></i></button>
  </div>
  <div class="wish-items" id="wishItems"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- FOOTER -->
<div class="footer">
  <div class="container">&copy; 2025 Foundris Welfare Foundation. All rights reserved.</div>
</div>

<script>
const API_BASE = '';
let currentCategory = 'all';
let currentSubcategory = '';
let currentPage = 1;
let allCategories = {};
let orderQty = 1;

// ============ CART & WISHLIST (localStorage) ============
let cart = JSON.parse(localStorage.getItem('fwf_cart') || '[]');
let wishlist = JSON.parse(localStorage.getItem('fwf_wishlist') || '[]');

function saveCart(){ localStorage.setItem('fwf_cart', JSON.stringify(cart)); updateCartUI(); }
function saveWishlist(){ localStorage.setItem('fwf_wishlist', JSON.stringify(wishlist)); updateWishUI(); }

function updateCartUI(){
  const count = cart.reduce((s,i) => s + i.qty, 0);
  const badge = document.getElementById('cartBadge');
  badge.textContent = count;
  badge.classList.toggle('show', count > 0);
  document.getElementById('cartCountLbl').textContent = count;
  renderCartItems();
}

function updateWishUI(){
  const count = wishlist.length;
  const badge = document.getElementById('wishBadge');
  badge.textContent = count;
  badge.classList.toggle('show', count > 0);
  document.getElementById('wishCountLbl').textContent = count;
  renderWishItems();
  // Update product card hearts
  document.querySelectorAll('.product-card .wishlist-btn').forEach(btn => {
    const pid = btn.dataset.pid;
    const inWish = wishlist.some(w => w.id === pid);
    btn.classList.toggle('wishlisted', inWish);
    btn.querySelector('i').className = inWish ? 'fas fa-heart' : 'far fa-heart';
  });
}

function addToCart(product, qty){
  qty = qty || 1;
  const pid = product.product_id || product.id;
  const existing = cart.find(i => i.id === pid);
  if(existing){ existing.qty += qty; }
  else {
    cart.push({
      id: pid,
      title: product.title,
      price: product.price,
      image: product.thumbnail || (product.images && product.images[0]) || '',
      seller: product.seller_name || 'FWF Seller',
      qty: qty
    });
  }
  saveCart();
  showToast('Added to cart');
}

function removeFromCart(pid){
  cart = cart.filter(i => i.id !== pid);
  saveCart();
}

function updateCartQty(pid, delta){
  const item = cart.find(i => i.id === pid);
  if(!item) return;
  item.qty = Math.max(1, item.qty + delta);
  saveCart();
}

function toggleWishlist(product, e){
  if(e){ e.stopPropagation(); e.preventDefault(); }
  const pid = product.product_id || product.id;
  const idx = wishlist.findIndex(w => w.id === pid);
  if(idx >= 0){
    wishlist.splice(idx, 1);
    showToast('Removed from wishlist');
  } else {
    wishlist.push({
      id: pid,
      title: product.title,
      price: product.price,
      image: product.thumbnail || (product.images && product.images[0]) || '',
      seller: product.seller_name || 'FWF Seller'
    });
    showToast('Added to wishlist');
  }
  saveWishlist();
}

function moveWishToCart(pid){
  const item = wishlist.find(w => w.id === pid);
  if(!item) return;
  const existing = cart.find(c => c.id === pid);
  if(!existing){
    cart.push({ id: item.id, title: item.title, price: item.price, image: item.image, seller: item.seller, qty: 1 });
    saveCart();
  }
  wishlist = wishlist.filter(w => w.id !== pid);
  saveWishlist();
  showToast('Moved to cart');
}

function renderCartItems(){
  const el = document.getElementById('cartItems');
  const footer = document.getElementById('cartFooter');
  if(!cart.length){
    el.innerHTML = '<div class="cart-empty"><i class="fas fa-shopping-bag"></i><p>Your cart is empty</p></div>';
    footer.style.display = 'none';
    return;
  }
  footer.style.display = 'block';
  let total = 0;
  el.innerHTML = cart.map(item => {
    total += item.price * item.qty;
    const imgHtml = item.image ? '<img src="' + item.image + '" alt=""/>' : '';
    return '<div class="cart-item">' +
      '<div class="cart-item-img">' + imgHtml + '</div>' +
      '<div class="cart-item-info">' +
        '<div class="name">' + esc(item.title) + '</div>' +
        '<div class="meta">' + esc(item.seller) + '</div>' +
        '<div class="cart-item-qty">' +
          '<button onclick="updateCartQty(\'' + item.id + '\',-1)">\u2212</button>' +
          '<span>' + item.qty + '</span>' +
          '<button onclick="updateCartQty(\'' + item.id + '\',1)">+</button>' +
        '</div>' +
      '</div>' +
      '<div class="cart-item-price">\u20B9' + fmtPrice(item.price * item.qty) + '</div>' +
      '<button class="cart-item-remove" onclick="removeFromCart(\'' + item.id + '\')"><i class="fas fa-trash-alt"></i></button>' +
    '</div>';
  }).join('');
  document.getElementById('cartTotalAmount').textContent = '\u20B9' + fmtPrice(total);
}

function renderWishItems(){
  const el = document.getElementById('wishItems');
  if(!wishlist.length){
    el.innerHTML = '<div class="wish-empty"><i class="far fa-heart"></i><p>Your wishlist is empty</p></div>';
    return;
  }
  el.innerHTML = wishlist.map(item => {
    const imgHtml = item.image ? '<img src="' + item.image + '" alt=""/>' : '';
    return '<div class="wish-item">' +
      '<div class="wish-item-img" onclick="openProduct(\'' + item.id + '\');toggleWishDrawer()">' + imgHtml + '</div>' +
      '<div class="wish-item-info" onclick="openProduct(\'' + item.id + '\');toggleWishDrawer()">' +
        '<div class="name">' + esc(item.title) + '</div>' +
        '<div class="price">\u20B9' + fmtPrice(item.price) + '</div>' +
      '</div>' +
      '<div class="wish-item-actions">' +
        '<button class="to-cart" onclick="moveWishToCart(\'' + item.id + '\')" title="Add to Cart"><i class="fas fa-shopping-bag"></i></button>' +
        '<button class="remove-wish" onclick="wishlist=wishlist.filter(function(w){return w.id!==\'' + item.id + '\'});saveWishlist();showToast(\'Removed\')" title="Remove"><i class="fas fa-trash-alt"></i></button>' +
      '</div>' +
    '</div>';
  }).join('');
}

function toggleCartDrawer(){
  document.getElementById('cartOverlay').classList.toggle('open');
  document.getElementById('cartDrawer').classList.toggle('open');
  document.getElementById('wishOverlay').classList.remove('open');
  document.getElementById('wishDrawer').classList.remove('open');
}

function toggleWishDrawer(){
  document.getElementById('wishOverlay').classList.toggle('open');
  document.getElementById('wishDrawer').classList.toggle('open');
  document.getElementById('cartOverlay').classList.remove('open');
  document.getElementById('cartDrawer').classList.remove('open');
}

function checkoutCart(){
  if(!cart.length) return;
  const firstItem = cart[0];
  toggleCartDrawer();
  openProduct(firstItem.id);
  showToast('Complete your order below');
}

// ============ INIT ============
document.addEventListener('DOMContentLoaded', async () => {
  updateCartUI();
  updateWishUI();
  await loadCategories();
  await loadProducts();
  document.getElementById('searchInput').addEventListener('keydown', e => { if(e.key === 'Enter') searchProducts(); });
});

// ============ CATEGORIES ============
async function loadCategories(){
  try {
    const r = await fetch(API_BASE + '/api/store/categories');
    const d = await r.json();
    if(!d.ok) return;
    allCategories = d.categories;
    document.getElementById('heroCats').textContent = Object.keys(d.categories).length;
    renderCategories();
  } catch(e){ console.error('Categories error:', e); }
}

function renderCategories(){
  const list = document.getElementById('catList');
  const mobile = document.getElementById('catMobile');
  let html = '';
  let mobileHtml = '<div class="cat-chip active" data-cat="all" onclick="filterCategory(\'all\',this)">All</div>';

  for(const [key, cat] of Object.entries(allCategories)){
    html += '<div class="cat-item" data-cat="' + key + '" onclick="filterCategory(\'' + key + '\',this)">' +
      '<i class="fas ' + cat.icon + '"></i> ' + cat.label + ' <span class="count"></span>' +
    '</div>';
    if(cat.subs && cat.subs.length){
      html += '<div class="cat-subs" data-parent="' + key + '">';
      cat.subs.forEach(sub => {
        html += '<div class="cat-sub" onclick="filterSubcategory(\'' + key + '\',\'' + sub + '\',this)">' + sub + '</div>';
      });
      html += '</div>';
    }
    mobileHtml += '<div class="cat-chip" data-cat="' + key + '" onclick="filterCategory(\'' + key + '\',this)">' + cat.label + '</div>';
  }
  list.innerHTML = html;
  mobile.innerHTML = mobileHtml;
}

function filterCategory(cat, el){
  currentCategory = cat;
  currentSubcategory = '';
  currentPage = 1;
  document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
  document.querySelectorAll('.cat-subs').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
  if(el) el.classList.add('active');
  else {
    var si = document.querySelector('.cat-item[data-cat="' + cat + '"]');
    var sc = document.querySelector('.cat-chip[data-cat="' + cat + '"]');
    if(si) si.classList.add('active');
    if(sc) sc.classList.add('active');
  }
  var subsEl = document.querySelector('.cat-subs[data-parent="' + cat + '"]');
  if(subsEl) subsEl.style.display = 'block';
  loadProducts();
}

function filterSubcategory(cat, sub, el){
  currentCategory = cat;
  currentSubcategory = sub;
  currentPage = 1;
  document.querySelectorAll('.cat-sub').forEach(s => s.classList.remove('active'));
  if(el) el.classList.add('active');
  loadProducts();
}

function searchProducts(){
  currentPage = 1;
  loadProducts();
}

// ============ PRODUCTS ============
async function loadProducts(){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><br>Loading...</div>';

  const params = new URLSearchParams();
  if(currentCategory && currentCategory !== 'all') params.set('category', currentCategory);
  if(currentSubcategory) params.set('subcategory', currentSubcategory);
  const search = document.getElementById('searchInput').value.trim();
  if(search) params.set('search', search);
  const sort = document.getElementById('sortSelect').value;
  if(sort) params.set('sort', sort);
  params.set('page', currentPage);
  params.set('limit', 24);

  try {
    const r = await fetch(API_BASE + '/api/store/products?' + params.toString());
    const d = await r.json();
    if(!d.ok){ grid.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>Something went wrong</h3></div>'; return; }

    document.getElementById('resultsCount').textContent = d.total + ' product' + (d.total !== 1 ? 's' : '');
    document.getElementById('countAll').textContent = d.total;
    document.getElementById('heroTotal').textContent = d.total;

    if(d.categoryStats){
      d.categoryStats.forEach(cs => {
        const el = document.querySelector('.cat-item[data-cat="' + cs.category + '"] .count');
        if(el) el.textContent = cs.count;
      });
    }

    if(!d.products.length){
      grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1">' +
        '<i class="fas fa-box-open"></i>' +
        '<h3>No products found</h3>' +
        '<p>' + (search ? 'Try a different search term' : 'Check back soon for new listings!') + '</p>' +
      '</div>';
      document.getElementById('pagination').innerHTML = '';
      return;
    }

    grid.innerHTML = d.products.map(p => renderProductCard(p)).join('');
    renderPagination(d.page, d.pages, d.total);
    updateWishUI();
  } catch(e){
    console.error('Load error:', e);
    grid.innerHTML = '<div class="empty-state" style="grid-column:1/-1">' +
      '<i class="fas fa-wifi"></i>' +
      '<h3>Unable to load products</h3>' +
      '<p>Please check your connection and try again</p>' +
    '</div>';
  }
}

function renderProductCard(p){
  const imgHtml = p.thumbnail
    ? '<img src="' + p.thumbnail + '" alt="' + esc(p.title) + '" loading="lazy"/>'
    : (p.images && p.images.length ? '<img src="' + p.images[0] + '" alt="' + esc(p.title) + '" loading="lazy"/>' : '<i class="fas fa-image placeholder"></i>');
  const catInfo = allCategories[p.category];
  const catLabel = catInfo ? catInfo.label : p.category;
  const discount = p.discount_percent > 0 ? '<span class="discount">' + p.discount_percent + '% off</span>' : '';
  const mrp = p.mrp && p.mrp > p.price ? '<span class="mrp">\u20B9' + fmtPrice(p.mrp) + '</span>' : '';
  const badge = p.discount_percent >= 20 ? '<div class="badge">' + p.discount_percent + '% Off</div>' : '';
  const rating = p.rating_avg > 0 ? '<div class="rating"><i class="fas fa-star"></i> ' + p.rating_avg.toFixed(1) + ' <span class="count">(' + p.rating_count + ')</span></div>' : '';
  const isWished = wishlist.some(w => w.id === p.product_id);
  const pDataStr = JSON.stringify({product_id:p.product_id,title:p.title,price:p.price,thumbnail:p.thumbnail,images:p.images,seller_name:p.seller_name});
  const pDataAttr = pDataStr.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

  return '<div class="product-card" data-product="' + pDataAttr + '" onclick="openProduct(\'' + p.product_id + '\')">' +
    badge +
    '<button class="wishlist-btn ' + (isWished?'wishlisted':'') + '" data-pid="' + p.product_id + '" onclick="event.stopPropagation();toggleWishlist(JSON.parse(this.closest(\'.product-card\').dataset.product))">' +
      '<i class="' + (isWished?'fas':'far') + ' fa-heart"></i>' +
    '</button>' +
    '<div class="img-wrap">' + imgHtml +
      '<div class="quick-actions">' +
        '<button class="btn-add-cart" onclick="event.stopPropagation();addToCart(JSON.parse(this.closest(\'.product-card\').dataset.product))"><i class="fas fa-shopping-bag"></i> Add to Cart</button>' +
      '</div>' +
    '</div>' +
    '<div class="info">' +
      '<div class="cat-label">' + esc(catLabel) + (p.subcategory ? ' &bull; ' + esc(p.subcategory) : '') + '</div>' +
      '<div class="title">' + esc(p.title) + '</div>' +
      '<div class="seller"><i class="fas fa-user-circle"></i> ' + esc(p.seller_name || 'FWF Seller') + '</div>' +
      '<div class="price-row">' +
        '<span class="price">\u20B9' + fmtPrice(p.price) + '</span> ' +
        mrp + ' ' + discount +
      '</div>' +
      rating +
    '</div>' +
  '</div>';
}

function renderPagination(page, pages){
  const el = document.getElementById('pagination');
  if(pages <= 1){ el.innerHTML = ''; return; }
  let html = '<button ' + (page<=1?'disabled':'') + ' onclick="goPage(' + (page-1) + ')"><i class="fas fa-chevron-left"></i></button>';
  const start = Math.max(1, page - 2);
  const end = Math.min(pages, page + 2);
  if(start > 1) html += '<button onclick="goPage(1)">1</button>';
  if(start > 2) html += '<button disabled>...</button>';
  for(let i = start; i <= end; i++){
    html += '<button class="' + (i===page?'active':'') + '" onclick="goPage(' + i + ')">' + i + '</button>';
  }
  if(end < pages - 1) html += '<button disabled>...</button>';
  if(end < pages) html += '<button onclick="goPage(' + pages + ')">' + pages + '</button>';
  html += '<button ' + (page>=pages?'disabled':'') + ' onclick="goPage(' + (page+1) + ')"><i class="fas fa-chevron-right"></i></button>';
  el.innerHTML = html;
}

function goPage(p){ currentPage = p; loadProducts(); window.scrollTo({top:300,behavior:'smooth'}); }

// ============ PRODUCT DETAIL MODAL ============
let currentModalProduct = null;

async function openProduct(productId){
  const modal = document.getElementById('productModal');
  const body = document.getElementById('modalBody');
  modal.classList.add('show');
  document.body.style.overflow = 'hidden';
  body.innerHTML = '<div class="loading" style="grid-column:1/-1;padding:60px"><i class="fas fa-spinner"></i><br>Loading...</div>';

  try {
    const r = await fetch(API_BASE + '/api/store/product/' + productId);
    const d = await r.json();
    if(!d.ok){ body.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><h3>Product not found</h3></div>'; return; }
    currentModalProduct = d.product;
    renderProductDetail(d.product);
  } catch(e){
    body.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><h3>Failed to load product</h3></div>';
  }
}

function renderProductDetail(p){
  const body = document.getElementById('modalBody');
  orderQty = 1;

  const images = p.images && p.images.length ? p.images : (p.thumbnail ? [p.thumbnail] : []);
  let galleryHtml = '<div class="modal-gallery">' +
    '<div class="main-img" id="mainImg">' +
      (images.length ? '<img src="' + images[0] + '" alt="' + esc(p.title) + '"/>' : '<i class="fas fa-image" style="font-size:4rem;color:var(--brd)"></i>') +
    '</div>';
  if(images.length > 1){
    galleryHtml += '<div class="thumbs">';
    images.forEach(function(img,i){
      galleryHtml += '<div class="thumb ' + (i===0?'active':'') + '" onclick="switchImage(this,\'' + img.replace(/'/g,"\\'") + '\')"><img src="' + img + '" alt="thumb"/></div>';
    });
    galleryHtml += '</div>';
  }
  galleryHtml += '</div>';

  const catInfo = allCategories[p.category];
  const catLabel = catInfo ? catInfo.label : p.category;
  const discount = p.discount_percent > 0 ? '<span class="discount">' + p.discount_percent + '% off</span>' : '';
  const mrp = p.mrp && p.mrp > p.price ? '<span class="mrp">\u20B9' + fmtPrice(p.mrp) + '</span>' : '';
  const stockClass = p.stock > 5 ? 'in-stock' : (p.stock > 0 ? 'low-stock' : '');
  const stockText = p.stock > 5 ? 'In Stock' : (p.stock > 0 ? 'Only ' + p.stock + ' left' : 'Out of Stock');
  const isWished = wishlist.some(w => w.id === p.product_id);

  let metaHtml = '';
  if(p.brand) metaHtml += '<div class="meta-item"><strong>Brand:</strong> ' + esc(p.brand) + '</div>';
  if(p.condition && p.condition !== 'new') metaHtml += '<div class="meta-item"><strong>Condition:</strong> ' + esc(p.condition) + '</div>';
  if(p.material) metaHtml += '<div class="meta-item"><strong>Material:</strong> ' + esc(p.material) + '</div>';
  if(p.color) metaHtml += '<div class="meta-item"><strong>Color:</strong> ' + esc(p.color) + '</div>';
  if(p.size) metaHtml += '<div class="meta-item"><strong>Size:</strong> ' + esc(p.size) + '</div>';
  if(p.weight) metaHtml += '<div class="meta-item"><strong>Weight:</strong> ' + esc(p.weight) + '</div>';

  let detailsHtml = '<div class="modal-details">' +
    '<div class="cat-label">' + esc(catLabel) + (p.subcategory ? ' &bull; ' + esc(p.subcategory) : '') + '</div>' +
    '<h2>' + esc(p.title) + '</h2>' +
    '<div class="seller-info"><i class="fas fa-user-circle"></i> Sold by <strong>' + esc(p.seller_name || 'FWF Seller') + '</strong></div>' +
    '<div class="price-section">' +
      '<span class="price">\u20B9' + fmtPrice(p.price) + '</span> ' + mrp + ' ' + discount +
    '</div>' +
    '<div class="stock-info ' + stockClass + '"><i class="fas fa-' + (p.stock > 0 ? 'check-circle' : 'times-circle') + '"></i> ' + stockText + '</div>' +
    '<div class="modal-actions">' +
      '<button class="btn-modal cart-btn" onclick="addToCart(currentModalProduct,orderQty)" ' + (p.stock<=0?'disabled':'') + '><i class="fas fa-shopping-bag"></i> Add to Cart</button>' +
      '<button class="btn-modal wish-btn ' + (isWished?'wishlisted':'') + '" onclick="toggleWishlist(currentModalProduct);this.classList.toggle(\'wishlisted\');var ic=this.querySelector(\'i\');ic.className=this.classList.contains(\'wishlisted\')?\'fas fa-heart\':\'far fa-heart\'">' +
        '<i class="' + (isWished?'fas':'far') + ' fa-heart"></i> ' + (isWished?'Wishlisted':'Wishlist') +
      '</button>' +
    '</div>' +
    (metaHtml ? '<div class="meta-grid">' + metaHtml + '</div>' : '') +
    (p.description ? '<div class="desc">' + esc(p.description) + '</div>' : '') +
    '<div class="order-section" id="orderSection">' +
      '<h4><i class="fas fa-shopping-cart"></i> Place Order</h4>' +
      '<div class="order-form" id="orderForm">' +
        '<input type="text" id="ordName" placeholder="Your Name *" required/>' +
        '<input type="text" id="ordContact" placeholder="Mobile Number *" required/>' +
        '<input type="email" id="ordEmail" placeholder="Email (optional)"/>' +
        '<div class="qty-row">' +
          '<button class="qty-btn" type="button" onclick="changeQty(-1)">\u2212</button>' +
          '<span class="qty-val" id="qtyVal">1</span>' +
          '<button class="qty-btn" type="button" onclick="changeQty(1)">+</button>' +
          '<span style="font-size:.85rem;color:var(--muted);margin-left:8px">\u00D7\u20B9' + fmtPrice(p.price) + ' = <strong id="orderTotal">\u20B9' + fmtPrice(p.price) + '</strong></span>' +
        '</div>' +
        '<textarea class="full" id="ordAddress" placeholder="Delivery Address *" required></textarea>' +
        '<select id="ordPayment">' +
          '<option value="online">Online Payment</option>' +
          '<option value="cod">Cash on Delivery</option>' +
          '<option value="upi">UPI</option>' +
        '</select>' +
        '<button class="btn-order" id="btnOrder" onclick="placeOrder(\'' + p.product_id + '\',' + p.price + ')" ' + (p.stock<=0?'disabled':'') + '>' +
          (p.stock > 0 ? '<i class="fas fa-check"></i> Place Order' : 'Out of Stock') +
        '</button>' +
      '</div>' +
    '</div>' +
    '<div class="order-success" id="orderSuccess">' +
      '<i class="fas fa-check-circle"></i>' +
      '<h3>Order Placed Successfully!</h3>' +
      '<p id="orderSuccessMsg">Your order ID will appear here</p>' +
    '</div>' +
  '</div>';

  body.innerHTML = galleryHtml + detailsHtml;
}

function switchImage(el, src){
  document.querySelector('#mainImg img').src = src;
  document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}

function changeQty(delta){
  orderQty = Math.max(1, orderQty + delta);
  document.getElementById('qtyVal').textContent = orderQty;
  const price = parseFloat(document.querySelector('.modal-details .price').textContent.replace('\u20B9','').replace(/,/g,''));
  document.getElementById('orderTotal').textContent = '\u20B9' + fmtPrice(price * orderQty);
}

async function placeOrder(productId, unitPrice){
  const name = document.getElementById('ordName').value.trim();
  const contact = document.getElementById('ordContact').value.trim();
  const email = document.getElementById('ordEmail').value.trim();
  const address = document.getElementById('ordAddress').value.trim();
  const payment = document.getElementById('ordPayment').value;

  if(!name || !contact || !address){
    showToast('Please fill Name, Mobile & Address', 'error');
    return;
  }
  const btn = document.getElementById('btnOrder');
  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Placing Order...';

  try {
    const r = await fetch(API_BASE + '/api/store/order', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        productId: productId,
        quantity: orderQty,
        buyerName: name,
        buyerContact: contact,
        buyerEmail: email,
        buyerAddress: address,
        paymentMode: payment
      })
    });
    const d = await r.json();
    if(d.ok){
      document.getElementById('orderForm').style.display = 'none';
      var suc = document.getElementById('orderSuccess');
      suc.classList.add('show');
      document.getElementById('orderSuccessMsg').innerHTML = 'Order ID: <strong>' + d.orderId + '</strong><br>Total: \u20B9' + fmtPrice(d.total) + '<br><br>We will contact you soon to confirm.';
      showToast('Order placed successfully!');
      cart = cart.filter(function(i){ return i.id !== productId; });
      saveCart();
    } else {
      showToast(d.error || 'Failed to place order', 'error');
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-check"></i> Place Order';
    }
  } catch(e){
    showToast('Network error. Please try again.', 'error');
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-check"></i> Place Order';
  }
}

function closeProductModal(){
  document.getElementById('productModal').classList.remove('show');
  document.body.style.overflow = '';
  currentModalProduct = null;
}

document.getElementById('productModal').addEventListener('click', function(e){
  if(e.target.classList.contains('modal-overlay')) closeProductModal();
});

// ============ UTILITIES ============
function esc(s){ if(!s) return ''; var d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function fmtPrice(n){ return Number(n).toLocaleString('en-IN', { minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
function showToast(msg, type){
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.style.background = type === 'error' ? 'var(--gF)' : 'var(--deep)';
  t.classList.add('show');
  setTimeout(function(){ t.classList.remove('show'); }, 3000);
}

window.addEventListener('scroll', function(){
  document.getElementById('siteHeader').classList.toggle('scrolled', window.scrollY > 20);
});

document.addEventListener('keydown', function(e){
  if(e.key === 'Escape'){
    closeProductModal();
    if(document.getElementById('cartDrawer').classList.contains('open')) toggleCartDrawer();
    if(document.getElementById('wishDrawer').classList.contains('open')) toggleWishDrawer();
  }
});
</script>
</body>
</html>
